(window.webpackJsonp=window.webpackJsonp||[]).push([[67],{385:function(s,t,a){"use strict";a.r(t);var n=a(25),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"手把手教你发个-npm-包"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#手把手教你发个-npm-包"}},[s._v("#")]),s._v(" 👉 手把手教你发个 npm 包")]),s._v(" "),t("h2",{attrs:{id:"什么是-npm-包"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#什么是-npm-包"}},[s._v("#")]),s._v(" 什么是 npm 包？")]),s._v(" "),t("p",[s._v("npm 是包管理工具，是前端模块化下的一个标志性产物。那什么是包呢？🍞 ？👜 ？❌ ！node.js 中的第三方模块又叫做包，包是由第三方个人或团队开发出来的，供其他开发者使用的模块代码。通过 npm 这个包管理工具创建发布包和下载包，复用包里面的工具代码，从而提高工作效率。")]),s._v(" "),t("p",[s._v("本文将会通过实现一个版本比较的小功能，手把手教如何发一个 npm 包。")]),s._v(" "),t("p",[s._v("包含哪些内容？")]),s._v(" "),t("ul",[t("li",[s._v("发布一个 Typescript 包，包含函数声明文件")]),s._v(" "),t("li",[s._v("rollup 打包，支持 COMMONJS / UMD / ES Module 格式")]),s._v(" "),t("li",[s._v("ESlint 校验， commit message 格式约束")]),s._v(" "),t("li",[s._v("发包前自动升级版本并构建")]),s._v(" "),t("li",[s._v("一些关于 npm 包的小 tips")])]),s._v(" "),t("h2",{attrs:{id:"准备"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#准备"}},[s._v("#")]),s._v(" 准备")]),s._v(" "),t("h3",{attrs:{id:"注册账号"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#注册账号"}},[s._v("#")]),s._v(" 注册账号")]),s._v(" "),t("p",[s._v("发布包之前你必须拥有一个 npm 的账号，戳 https://www.npmjs.com/ 官网链接，注册一个账号。")]),s._v(" "),t("h3",{attrs:{id:"创建项目"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建项目"}},[s._v("#")]),s._v(" 创建项目")]),s._v(" "),t("p",[s._v("创建项目，初始化项目基本结构和更新 "),t("code",[s._v("package.json")]),s._v(" 文件，用于描述当前项目的功能。")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" compare_version\n\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" compare_version\n")])])]),t("p",[s._v("接着初始化 npm 包的一些配置：")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" init\n\n// 接下过程是以问答式 CLI 方式进行\n// Q1：package name: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("文件夹名字"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" 默认会以文件夹名字命名，当然也可以自定义包名，但需要遵守 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" 命名规范\n// Q2：version: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v(".0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" 版本号，默认是 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v(".0，具体版本号规则，可参考《语义化版本 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.0")]),s._v(".0》\n// Q3：description: "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" 包描述，用于描述这个包的主要功能以及用途\n// Q4：entry point: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("index.js"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" 入口文件，即从那个文件开始执行\n// Q5：test command: "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" 测试命令，用于包测试的命令，可以后续补充关于测试包的编写\n// Q6：git repository: "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" 项目的 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" 存储库地址\n// Q7：keywords: "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" 描述包的关键字，用于在 npmjs 上查询关键字\n// Q8：author: "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" 作者名字，可以使用 npmjs 名称、npmjs 注册邮箱、github 注册邮箱\n// Q9：license: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ISC"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" 开源协议，默认 ISC\n// Q10：输出 package.js 内容并询问 Is this OK? "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("yes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" 默认为 yes，回车后生成文件\n")])])]),t("p",[s._v("在初始化的 "),t("code",[s._v("package.json")]),s._v(" 文件中，它包含了你的项目信息以及众多配置项。除此之外，也可以写一个 "),t("code",[s._v("README.md")]),s._v(" 文件用来描述你的项目。这里举个 "),t("code",[s._v("package.json")]),s._v("的具体配置例子:")]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"compare_version_lib"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"version"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1.0.0"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"description"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"This is a js library that help you to compare two version number."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"main"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dist/index.umd.js"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"module"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dist/index.esm.js"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"types"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dist/index.d.ts"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"scripts"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"dev"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rollup -w -c"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"build"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rollup -c"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"test"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"jest"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"prepare"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"husky install"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"keywords"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"author"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"chieminchan"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"license"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MIT"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"repository"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"type"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"git"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"url"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://github.com/chieminchan/compare_version_lib.git"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"files"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"src/"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dist/"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"devDependencies"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("ul",[t("li",[s._v("files 字段是用于约定在发包的时候 NPM 会发布包含的文件和文件夹。"),t("strong",[s._v("注意： files 字段中文件夹名直接写名字，不要包含 ./ 字符，否则打包出来的产物不会包含该文件夹。")])])]),s._v(" "),t("h4",{attrs:{id:"npm-包命名机制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#npm-包命名机制"}},[s._v("#")]),s._v(" npm 包命名机制")]),s._v(" "),t("p",[s._v("在 npm 的包管理系统中，有一种 scoped packages 机制，用于将一些 packages 以 "),t("code",[s._v("@scope/package")]),s._v(" 的命名形式，让同个域级的包集中在一个命名空间下面，实现域级的包管理，同时还能避免包名冲突的情况。")]),s._v(" "),t("ul",[t("li",[t("p",[t("code",[s._v("npm view packageName")]),s._v(" 查看包是否被占用，并可以查看它的一些基本信息，若包名称从未被使用过，则会抛出 404 错误。")])]),s._v(" "),t("li",[t("p",[s._v("在初始化项目时，可以使用命令行来添加 scope："),t("code",[s._v("npm init --scope=scopeName")])])]),s._v(" "),t("li",[t("p",[s._v("同域级范围内的包会被安装在相同的文件路径下 "),t("code",[s._v("node_modules/@scopeName/")]),s._v("： 562 "),t("img",{attrs:{src:"https://s1.ax1x.com/2022/03/22/qQ5d1I.png",alt:"qQ5d1I.png"}})])]),s._v(" "),t("li",[t("p",[s._v("例如：vue 框架里面涉及的一些脚手架工具包：@vue/cli-plugin-babel、@vue/cli-plugin-eslint 等等域级包。")])])]),s._v(" "),t("h3",{attrs:{id:"初始化-typescript-环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#初始化-typescript-环境"}},[s._v("#")]),s._v(" 初始化 Typescript 环境")]),s._v(" "),t("p",[s._v("我们打包给用户，在用户引用时，还需要支持在 TS 环境下的代码提示，所以再来快速初始化生成一个 "),t("code",[s._v("tsconfig.json")]),s._v(" 文件，该文件属于 Typescript 配置文件。")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" typescript "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-D")]),s._v("\n\ntsc "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--init")]),s._v("\n")])])]),t("p",[s._v("按需配置"),t("code",[s._v("tsconfig.json")]),s._v("文件：")]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"compilerOptions"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"rootDir"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./src"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"declaration"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"declarationDir"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./dist"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"outDir"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./dist"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"target"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ES2015"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"module"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ES2020"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"strict"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"esModuleInterop"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"forceConsistentCasingInFileNames"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("ul",[t("li",[s._v("使用 declaration 会自动生成类型声明文件。配置后，在编译过程中会向 "),t("code",[s._v("./dist")]),s._v(" 目录输出 "),t("code",[s._v("index.d.ts")]),s._v(" 类型声明文件")]),s._v(" "),t("li",[s._v("target 表示要编译出的代码格式，一般使用 es6")]),s._v(" "),t("li",[s._v("module 表示源代码的语法版本，这是使用最新的 es2020。")])]),s._v(" "),t("h3",{attrs:{id:"引入打包编译工具"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#引入打包编译工具"}},[s._v("#")]),s._v(" 引入打包编译工具")]),s._v(" "),t("p",[s._v("包发布前，我们需要将编写的代码打包编译成 js 代码，并进行相关压缩操作。")]),s._v(" "),t("p",[s._v("rollup 是一个 JavaScript 模块打包器，在功能上要完成的事和 webpack 性质是一样的，就是将小块代码编译成大块复杂的代码。在平时开发应用程序时，我们基本上选择用 webpack。这里使用 rollup，相比 webpack 它更轻量，配置少，比较适合工具库的打包。")]),s._v(" "),t("p",[s._v("这里需要先初始化 Rollup 打包环境：")]),s._v(" "),t("ul",[t("li",[s._v("rollup 安装")])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" rollup "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-g")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 全局安装")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" rollup "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-D")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 项目本地安装")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" @rollup/plugin-typescript "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-D")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将Typescript转换成为 ES6+ 标准")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" @rollup/plugin-commonjs "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-D")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rollup默认不支持CommonJS，自己写的时候可以尽量避免使用CommonJS模块的语法，但有些外部库的是cjs或者umd（由webpack打包的）。如果使用这些外部库就需要支持CommonJS模块。")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" @rollup/plugin-node-resolve "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-D")]),s._v("\n")])])]),t("ul",[t("li",[s._v("创建配置文件 "),t("code",[s._v("rollup.config.js")])])]),s._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" commonjs "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"@rollup/plugin-commonjs"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" typescript "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"@rollup/plugin-typescript"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("input")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"src/index.ts"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("output")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("file")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dist/index.esm.js"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("format")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"es"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("file")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dist/index.umd.js"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("format")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"umd"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"index.umd.js"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("plugins")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("commonjs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("typescript")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("p",[s._v("上述文件表示我们要打包编译出两个文件，分别是 UMD 格式的和 ES Module 格式的。UMD 格式需要定义一个变量，这样在浏览器环境下，所有的方法都会挂载在这个变量上了。")]),s._v(" "),t("ul",[t("li",[s._v("增加编译命令")])]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"script"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"dev"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rollup -w -c"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"build"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rollup -c"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("p",[s._v("如此，我们便可以通过 "),t("code",[s._v("npm run dev")]),s._v("，就能在开发的时候实时编译。如果需要打包，则先执行 "),t("code",[s._v("npm run build")]),s._v(" 命令即可完成编译打包。")]),s._v(" "),t("h3",{attrs:{id:"eslint-配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#eslint-配置"}},[s._v("#")]),s._v(" ESlint 配置")]),s._v(" "),t("p",[s._v("运行初始化配置命令，根据项目情况来设置特地配置：")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" init @eslint/config\n")])])]),t("p",[s._v("其中，会触发安装以下三个依赖：")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-D")]),s._v(" eslint @typescript-eslint/parser @typescript-eslint/eslint-plugin\n")])])]),t("ul",[t("li",[t("p",[t("code",[s._v("eslint")]),s._v("：ESLint 的核心代码")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("@typescript-eslint/parser")]),s._v("：ESLint 的解析器，用于解析 typescript。因为 eslint 检测代码的核心原理是，先将 JS 代码生成 AST，然后遍历 AST，在不同类型的节点进行不同规则的批评校验。而 TS 无法直接生成 AST，因此需要先 parser ，才能进一步对 Typescript 代码进行检查和规范")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("@typescript-eslint/eslint-plugin")]),s._v("：这是一个 ESLint 插件，包含了各类定义好的检测 Typescript 代码的规范")])])]),s._v(" "),t("p",[s._v("最终，项目根目录下会生成"),t("code",[s._v(".eslintrc.json")]),s._v("文件，该文件中定义 ESLint 的基础配置，比如：一个简单的配置如下：")]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"env"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"browser"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"es2021"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"extends"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"eslint:recommended"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"plugin:@typescript-eslint/recommended"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"parser"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"@typescript-eslint/parser"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"parserOptions"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"ecmaVersion"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"latest"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"sourceType"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"module"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"plugins"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"@typescript-eslint"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"rules"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("ul",[t("li",[t("code",[s._v("eslint:recommended")]),s._v("，这个配置文件的 rules 部分开启了所有 ESLint 推荐使用的规则")]),s._v(" "),t("li",[s._v("同时，也可以通过 plugin 插件引入可共享配置。为"),t("code",[s._v("plugin:{plugin_pacakge_name}/{config_name}")])]),s._v(" "),t("li",[s._v("extends 允许配置多个模块，如果模块间的配置有冲突，位置靠后的配置会覆盖前面的。")]),s._v(" "),t("li",[s._v("个性化的约束规则可以在 rules 进行设置，当 rules 和 extends 中配置了相同规则，rules 中的配置的优先级会高于 extends。")])]),s._v(" "),t("h3",{attrs:{id:"husky-git-提交约束"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#husky-git-提交约束"}},[s._v("#")]),s._v(" Husky - Git 提交约束")]),s._v(" "),t("p",[s._v("Eslint 对我们编码格式进行了约束，但难以避免没有按要求进行格式化代码就提交到了远程的情况。为此，引入 Husky，在"),t("code",[s._v("git commit")]),s._v(" 提交前进行自动格式化暂存区内文件，以及校验是否符合 Eslint 规则，从而明确统一远程仓库代码的规范。")]),s._v(" "),t("h4",{attrs:{id:"husky-是什么"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#husky-是什么"}},[s._v("#")]),s._v(" Husky 是什么？")]),s._v(" "),t("p",[s._v("在项目的 "),t("code",[s._v(".git/hooks")]),s._v(" 文件夹内有很多 Hooks，这些钩子会在 git 执行的某些节点被触发。以一次 commit 为例，会先后触发 "),t("code",[s._v("pre-commit")]),s._v("、"),t("code",[s._v("prepare-commit-msg")]),s._v("、"),t("code",[s._v("commit-msg")]),s._v(" 和 "),t("code",[s._v("post-commit")]),s._v(" 等 hooks。")]),s._v(" "),t("p",[s._v("随机打开其中的 "),t("code",[s._v(".git/hooks/pre-commit.sample")]),s._v("，可以看到，实质上是一个 shell 脚本。Git 提供了一个自定义 Hooks 文件夹的 config，可以通过设置 "),t("code",[s._v("core.hooksPath")]),s._v("指向自定义目录，即，我们可以自定义设置 shell 脚本来实现个性化功能。")]),s._v(" "),t("p",[s._v("回到主题上，Husky 就是能够简化创建或者修改 Githooks 过程的工具。")]),s._v(" "),t("p",[s._v("它最新的运作原理大概就是：")]),s._v(" "),t("ol",[t("li",[t("code",[s._v("husky install")]),s._v(" 安装时创建 hooks，将 "),t("code",[s._v("git hooks")]),s._v(" 的目录指定为"),t("code",[s._v(".husky/")])]),s._v(" "),t("li",[s._v("提交时从配置文件中（"),t("code",[s._v("package.json")]),s._v("、"),t("code",[s._v(".huskyrc")]),s._v("、"),t("code",[s._v(".huskyrc.json")]),s._v("...）读取相应的 hook 配置，使用 "),t("code",[s._v("husky add")]),s._v(" 命令向 "),t("code",[s._v(".husky/")]),s._v(" 中添加 hook")]),s._v(" "),t("li",[s._v("特定时机，触发执行配置中的指令/脚本")])]),s._v(" "),t("p",[s._v("具体原理结合源码分析可以参考： "),t("a",{attrs:{href:"https://juejin.cn/post/6879955438482227207#heading-2",target:"_blank",rel:"noopener noreferrer"}},[s._v("Husky 原理解析及在代码 Lint 中的应用 "),t("OutboundLink")],1)]),s._v(" "),t("h4",{attrs:{id:"husky-配合-lint-staged-食用更佳"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#husky-配合-lint-staged-食用更佳"}},[s._v("#")]),s._v(" Husky 配合 lint-staged 食用更佳")]),s._v(" "),t("ul",[t("li",[s._v("引入 commitlint，校验提交的 message 格式是否符合规范，以此统一 git commit message。")]),s._v(" "),t("li",[s._v("引入 lint-staged，针对当次提交（暂存区的代码）的 "),t("code",[s._v("ts")]),s._v(" 和 "),t("code",[s._v("js")]),s._v(" 文件进行检测。")])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" husky "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-D")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" @commitlint/cli "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-D")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" @commitlint/config-conventional "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-D")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" lint-staged "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-D")]),s._v("\n")])])]),t("p",[t("code",[s._v("husky 6.0.0")]),s._v(" 版本以前，安装 "),t("code",[s._v("lint-staged")]),s._v(" 后，需要在 "),t("code",[s._v("package.json")]),s._v(" 文件中，设置我们需要的 git hooks：")]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"husky"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"hooks"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 在 commit 之前先，针对lint-staged配置的文件执行配置好的指令")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"pre-commit"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lint-staged"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 校验 commit 时添加的备注信息是否符合要求规范")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"commit-msg"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"commitlint -E HUSKY_GIT_PARAMS"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"commitlint"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"extends"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"@commitlint/config-conventional"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"lint-staged"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"*.{ts,js}"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node --max_old_space_size=8192 ./node_modules/.bin/prettier -w"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node --max_old_space_size=8192 ./node_modules/.bin/eslint --fix --color"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"git add"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("p",[s._v("以上的配置表示开发者在 "),t("code",[s._v("git commit")]),s._v(" 时，会首先调用 "),t("code",[s._v("lint-staged")]),s._v(" 相关命令： prettier 格式化，然后是 ESlint 校验并修复，然后将修改后的文件存入暂存区，然后是校验 commit message 是否符合规范，符合规范后才会成功 commit。")]),s._v(" "),t("p",[t("code",[s._v("husky 6.0.0")]),s._v(" 版本后，不再使用 "),t("code",[s._v(".huskyrc.js")]),s._v(" 文件，同时也不支持在 package.json 文件中进行 husky 相关配置，而是在 "),t("code",[s._v(".husky/")]),s._v(" 目录中配置的单个 git 钩子。")]),s._v(" "),t("p",[s._v("可以直接使用 "),t("code",[s._v("npx mrm@2 lint-staged")]),s._v(" 代替 "),t("code",[s._v("npm install lint-staged -D")]),s._v("，它会直接在项目中配置好 husky 和 lint-staged，你只需要在 package.json 中修改一下 lint-staged 检测文件范围")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("% npx mrm@2 lint-staged\nnpx: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("237")]),s._v(" 安装成功，用时 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("21.067")]),s._v(" 秒\nRunning lint-staged"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nUpdate package.json\nhusky - Git hooks installed\nhusky - created .husky/pre-commit\n")])])]),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"lint-staged"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"{*.js,jsx,ts,tsx}"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"eslint --cache --fix"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n")])])]),t("h2",{attrs:{id:"开发"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#开发"}},[s._v("#")]),s._v(" 开发")]),s._v(" "),t("p",[s._v("到这一步，可以开始编写代码啦！")]),s._v(" "),t("ul",[t("li"),s._v(" "),t("li",[t("p",[s._v("项目基本配置文件外，npm module 里的一般包括三个文件夹："),t("code",[s._v("dist | src | types")])]),s._v(" "),t("ul",[t("li",[s._v("dist 包编译后最终产出文件")]),s._v(" "),t("li",[s._v("src 源码文件")]),s._v(" "),t("li",[s._v("types 类型声明文件")])])]),s._v(" "),t("li",[t("p",[s._v("新建 "),t("code",[s._v("src/index.ts")]),s._v(" 文件")])])]),s._v(" "),t("div",{staticClass:"language-ts extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ts"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*\n * compare version\n * 比较版本号，版本号规则x.y.z，xyz均为大于等于0的整数\n * 0: 相等\n * 1: 大于\n * -1: 小于\n */")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*\n * compare version\n * 比较版本号，版本号规则x.y.z，xyz均为大于等于0的整数\n * 0: 相等\n * 1: 大于\n * -1: 小于\n */")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("COMPARE_RESULT_MAP")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("BIGGER")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SMALLER")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SAME")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("versionCompare")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("version1"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" version2"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("number")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" version1Arr "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" version1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("split")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" version2Arr "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" version2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("split")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" maxLength "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Math"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("max")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("version1Arr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("length"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" version2Arr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("length"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" maxLength"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" num1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("version1Arr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" num2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("version2Arr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("num1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!==")]),s._v(" num2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" num1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" num2\n                "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("COMPARE_RESULT_MAP")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("BIGGER")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("COMPARE_RESULT_MAP")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SMALLER")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("COMPARE_RESULT_MAP")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SAME")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" versionCompare"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("h2",{attrs:{id:"发布"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#发布"}},[s._v("#")]),s._v(" 发布")]),s._v(" "),t("h3",{attrs:{id:"设置发布仓库-registry"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#设置发布仓库-registry"}},[s._v("#")]),s._v(" 设置发布仓库 registry")]),s._v(" "),t("p",[s._v("在下载包时，有些人会偏向于设置 taobao 镜像，因为 npm 仓库服务器在国外，下载速度比较慢。发布的时候也一样，一般开源应用基本都发布到 npmjs，公司内部包的话就会发到私有 npm 仓库，我们可以在 package.json 设置一下你想要发布的仓库地址，默认是执行 publish 命令所指向的仓库：")]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"publishConfig"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"registry"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://registry.npm.xxx.com/"')]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("p",[s._v("也可以设置别名")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("// 设置别名\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("alias")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ynpm")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"npm --registry=http://registry.npm.xxx.com"')]),s._v("\n\n// 发布\nynpm publish\n")])])]),t("p",[s._v("发布包需要验证你的账号权限，第一次执行需要 "),t("code",[s._v("npm login")]),s._v(" 。")]),s._v(" "),t("h3",{attrs:{id:"版本管理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#版本管理"}},[s._v("#")]),s._v(" 版本管理")]),s._v(" "),t("p",[s._v("npm 的发包需要遵循语义化版本，一个版本号包含三个部分："),t("code",[s._v("major.minor.patch")]),s._v("，")]),s._v(" "),t("p",[s._v("我们可以使用 "),t("code",[s._v("npm version")]),s._v(" 命令来自动修改版本号，比如：")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("// version "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" v1.0.0\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" version major // 主版本号:当你做了不兼容的API修改\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# v2.0.0")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" version minor // 次版本号:当你做了向下兼容的功能性新增,可以理解为Feature版本\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# v2.1.0")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" version patch // 修订号:当你做了向下兼容的问题修正,可以理解为Bug fix版本\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# v2.1.1")]),s._v("\n\n")])])]),t("p",[s._v("一般来说还有先行版本，测试版本等，先行版本号是加到修订号后面，作为版本号的延伸；版本中携带 "),t("code",[s._v("alpha")]),s._v("、"),t("code",[s._v("beta")]),s._v("、"),t("code",[s._v("rc")]),s._v(" 等 tag 字样，统称先行版，带有预发布版本号的，一般格式为 "),t("code",[s._v("x.y.z-[tag].[次数 / meta 信息]")]),s._v("。比如："),t("code",[s._v("3.1.0-beta.0")]),s._v("、"),t("code",[s._v("3.1.0-alpha.0")])]),s._v(" "),t("p",[s._v("当要发行大版本或核心功能时，但不能保证这个版本完全正常，就要先发一个先行版本。我们可以使用 --preid 参数来发布先行版本，： "),t("code",[s._v("npm version prerelease --preid=alpha")]),s._v("。")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" version premajor // 预备主版本\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# v3.0.0-0")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" version preminor // 预备次版本\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# v3.1.0-0")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" version prepatch // 预备修订版本\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# v3.1.1-0")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" version prerelease // 预发布版本\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# v3.1.1-1")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" version prerelease "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--preid")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("alpha // 命名先行版,测试版用beta\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# v3.1.1-alpha.0")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" version prerelease // 升级先行版\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# v3.1.1-alpha.1")]),s._v("\n")])])]),t("p",[s._v("运行 "),t("code",[s._v("npm version")]),s._v(" 时，本地 "),t("code",[s._v("git status")]),s._v(" 需要是 clear 的，因为运行命令之后会自动提交一个 commit 并打上 tag，也可以自定义 commit message。")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" version patch "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"升级到 %s: 演示自定义msg"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# v3.1.1")]),s._v("\n")])])]),t("h3",{attrs:{id:"changelog"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#changelog"}},[s._v("#")]),s._v(" Changelog")]),s._v(" "),t("p",[s._v("包发布了很多次后，使用者升级就需要知道他是否需要升级，需要查看文档看看有哪些不兼容性改动，所以需要一个 Changelog 来记录每次发布改了些什么。")]),s._v(" "),t("p",[s._v("如果手动的维护肯定会有忘记的时候，所以需要使用工具来自动生成，我们可以使用 "),t("code",[s._v("standard-version")]),s._v(" 这个包来生成，这个包的作用是自动更新版本和生成 CHANGELOG。")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--D")]),s._v(" standard-version "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装 standard-version")]),s._v("\n")])])]),t("p",[s._v("将 npm run 脚本添加到您的 package.json：")]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"scripts"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"patch"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"standard-version --patch"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"release"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"standard-version"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"release:alpha"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"standard-version --prerelease alpha"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("p",[s._v("现在就可以使用 "),t("code",[s._v("npm run release --patch")]),s._v(" 代替 "),t("code",[s._v("npm version")]),s._v("。")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("% "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" run patch\n\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" compare_version_lib@1.1.1 patch /compare_version\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" standard-version "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--patch")]),s._v("\n\n✔ bumping version "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" package.json from "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.1")]),s._v(".1 to "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.1")]),s._v(".2\n✔ bumping version "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" package-lock.json from "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.1")]),s._v(".1 to "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.1")]),s._v(".2\n✔ outputting changes to CHANGELOG.md\n✔ committing package-lock.json and package.json and CHANGELOG.md\n→ No staged files match any configured task.\n✔ tagging release v1.1.2\nℹ Run "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" push --follow-tags origin master "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" publish"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v(" to publish\n\n// 会根据每个commit生成Changelog:\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Changelog")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### [1.1.2](https://github.com/chieminchan/compare_version_lib/compare/v1.1.1...v1.1.2) (2022-03-21)")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### Features")]),s._v("\n-   update srcript "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("2ea0d93"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("https://github.com/chieminchan/compare_version_lib/commit/2ea0d9369ed6c1019bc99a5fc1b2685727def39c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v("\n")])])]),t("h2",{attrs:{id:"tips"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tips"}},[s._v("#")]),s._v(" TIPS：")]),s._v(" "),t("h3",{attrs:{id:"package-json-的依赖版本号"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#package-json-的依赖版本号"}},[s._v("#")]),s._v(" package.json 的依赖版本号")]),s._v(" "),t("p",[s._v("在 package.json 的一些依赖的版本号中，我们还会看到^、~或者>=这样的标识符，或者不带标识符的，这都代表什么意思呢？")]),s._v(" "),t("p",[s._v("没有任何符号：完全百分百匹配，必须使用当前版本号对比符号类的：>(大于) >=(大于等于) <(小于) <=(小于等于) 波浪符号~：固定主版本号和次版本号，修订号可以随意更改，例如~2.0.0，可以使用 2.0.0、2.0.2 、2.0.9 的版本。插入符号^：固定主版本号，次版本号和修订号可以随意更改，例如^2.0.0，可以使用 2.0.1、2.2.2 、2.9.9 的版本。任意版本*：对版本没有限制，一般不用或符号：||可以用来设置多个版本号限制规则，例如 >= 3.0.0 || <= 1.0.0")]),s._v(" "),t("ul",[t("li",[s._v("通过 jsdelivr 可以方便的查看包内容")]),s._v(" "),t("li",[s._v("np 包，进行不同源的 npm 包发布管理的")])]),s._v(" "),t("p",[s._v("参考文章：")]),s._v(" "),t("ul",[t("li",[s._v("https://juejin.cn/post/6844903870678695943#heading-0")]),s._v(" "),t("li",[s._v("https://zhuanlan.zhihu.com/p/366786798")])])])}),[],!1,null,null,null);t.default=e.exports}}]);