<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>🌵 Vue | CHIEMINCHAN&#39;S BLOG</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/images/donut.png">
    <meta name="description" content="Hi, glad you came.">
    
    <link rel="preload" href="/assets/css/0.styles.8f3dca9f.css" as="style"><link rel="preload" href="/assets/js/app.448d156c.js" as="script"><link rel="preload" href="/assets/js/2.fefa3fa1.js" as="script"><link rel="preload" href="/assets/js/1.67a15f5a.js" as="script"><link rel="preload" href="/assets/js/78.81fd1ead.js" as="script"><link rel="prefetch" href="/assets/js/10.5229b01a.js"><link rel="prefetch" href="/assets/js/11.9dccb5a1.js"><link rel="prefetch" href="/assets/js/12.1aa023e7.js"><link rel="prefetch" href="/assets/js/13.da540175.js"><link rel="prefetch" href="/assets/js/14.981e669d.js"><link rel="prefetch" href="/assets/js/15.f28dd0b3.js"><link rel="prefetch" href="/assets/js/16.47e1d84d.js"><link rel="prefetch" href="/assets/js/17.7ff34030.js"><link rel="prefetch" href="/assets/js/18.6dcbdd16.js"><link rel="prefetch" href="/assets/js/19.e568fd00.js"><link rel="prefetch" href="/assets/js/20.182f1f9b.js"><link rel="prefetch" href="/assets/js/21.b834a74a.js"><link rel="prefetch" href="/assets/js/22.a3523cd2.js"><link rel="prefetch" href="/assets/js/23.61d15c5b.js"><link rel="prefetch" href="/assets/js/24.2aadb209.js"><link rel="prefetch" href="/assets/js/25.836695fb.js"><link rel="prefetch" href="/assets/js/26.0ab922cb.js"><link rel="prefetch" href="/assets/js/27.5ac9e339.js"><link rel="prefetch" href="/assets/js/28.d6a5eb15.js"><link rel="prefetch" href="/assets/js/29.3eea682e.js"><link rel="prefetch" href="/assets/js/3.fc739620.js"><link rel="prefetch" href="/assets/js/30.5225944d.js"><link rel="prefetch" href="/assets/js/31.ec02d3da.js"><link rel="prefetch" href="/assets/js/32.bd05dede.js"><link rel="prefetch" href="/assets/js/33.4a293dcf.js"><link rel="prefetch" href="/assets/js/34.4464026b.js"><link rel="prefetch" href="/assets/js/35.4dd4f327.js"><link rel="prefetch" href="/assets/js/36.ca28dda7.js"><link rel="prefetch" href="/assets/js/37.3a17971f.js"><link rel="prefetch" href="/assets/js/38.f86fa51b.js"><link rel="prefetch" href="/assets/js/39.6ff149b0.js"><link rel="prefetch" href="/assets/js/4.0471e9ae.js"><link rel="prefetch" href="/assets/js/40.23565895.js"><link rel="prefetch" href="/assets/js/41.0116a1ec.js"><link rel="prefetch" href="/assets/js/42.c38f3e0c.js"><link rel="prefetch" href="/assets/js/43.1d0d8ffd.js"><link rel="prefetch" href="/assets/js/44.631fa43e.js"><link rel="prefetch" href="/assets/js/45.0f88df1f.js"><link rel="prefetch" href="/assets/js/46.cc671ab0.js"><link rel="prefetch" href="/assets/js/47.90cce12d.js"><link rel="prefetch" href="/assets/js/48.ad0ce6a4.js"><link rel="prefetch" href="/assets/js/49.ade35f37.js"><link rel="prefetch" href="/assets/js/5.5356be46.js"><link rel="prefetch" href="/assets/js/50.de00c31b.js"><link rel="prefetch" href="/assets/js/51.9de8257a.js"><link rel="prefetch" href="/assets/js/52.50f1abf2.js"><link rel="prefetch" href="/assets/js/53.b3b3acb2.js"><link rel="prefetch" href="/assets/js/54.71bfe1b2.js"><link rel="prefetch" href="/assets/js/55.b00cfb1c.js"><link rel="prefetch" href="/assets/js/56.1bb058d3.js"><link rel="prefetch" href="/assets/js/57.5651fd65.js"><link rel="prefetch" href="/assets/js/58.3dd11306.js"><link rel="prefetch" href="/assets/js/59.233d45e8.js"><link rel="prefetch" href="/assets/js/6.5b3d5499.js"><link rel="prefetch" href="/assets/js/60.7c729149.js"><link rel="prefetch" href="/assets/js/61.eb5805f6.js"><link rel="prefetch" href="/assets/js/62.fde12179.js"><link rel="prefetch" href="/assets/js/63.3358d1e0.js"><link rel="prefetch" href="/assets/js/64.1b930210.js"><link rel="prefetch" href="/assets/js/65.3048ba53.js"><link rel="prefetch" href="/assets/js/66.a065502e.js"><link rel="prefetch" href="/assets/js/67.715eef17.js"><link rel="prefetch" href="/assets/js/68.edf44196.js"><link rel="prefetch" href="/assets/js/69.94cb6d60.js"><link rel="prefetch" href="/assets/js/7.c94df317.js"><link rel="prefetch" href="/assets/js/70.9061bb98.js"><link rel="prefetch" href="/assets/js/71.980c8e32.js"><link rel="prefetch" href="/assets/js/72.43be58ba.js"><link rel="prefetch" href="/assets/js/73.e2f40377.js"><link rel="prefetch" href="/assets/js/74.9ef8a48c.js"><link rel="prefetch" href="/assets/js/75.b006fb40.js"><link rel="prefetch" href="/assets/js/76.311cf38f.js"><link rel="prefetch" href="/assets/js/77.2d4b2c6d.js"><link rel="prefetch" href="/assets/js/79.01e24fba.js"><link rel="prefetch" href="/assets/js/80.b15cc1f3.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.934ed2fb.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8f3dca9f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">CHIEMINCHAN'S BLOG</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/articles/" class="nav-link">
  文章
</a></div><div class="nav-item"><a href="/fragments/" class="nav-link router-link-active">
  知识碎片
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法
</a></div><div class="nav-item"><a href="/reading/" class="nav-link">
  读/观后感
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GitHub" class="dropdown-title"><span class="title">GitHub</span> <span class="arrow down"></span></button> <button type="button" aria-label="GitHub" class="mobile-dropdown-title"><span class="title">GitHub</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/chieminchan" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub首页
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/articles/" class="nav-link">
  文章
</a></div><div class="nav-item"><a href="/fragments/" class="nav-link router-link-active">
  知识碎片
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法
</a></div><div class="nav-item"><a href="/reading/" class="nav-link">
  读/观后感
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GitHub" class="dropdown-title"><span class="title">GitHub</span> <span class="arrow down"></span></button> <button type="button" aria-label="GitHub" class="mobile-dropdown-title"><span class="title">GitHub</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/chieminchan" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub首页
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>知识碎片</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/fragments/" aria-current="page" class="sidebar-link">🌻 知识碎片</a></li><li><a href="/fragments/Vue.html" aria-current="page" class="active sidebar-link">🌵 Vue</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fragments/Vue.html#_001-vue-生命周期-钩子函数" class="sidebar-link">001： Vue 生命周期（钩子函数）</a></li><li class="sidebar-sub-header"><a href="/fragments/Vue.html#_002-父子组件挂载顺序是怎么样的" class="sidebar-link">002： 父子组件挂载顺序是怎么样的？</a></li><li class="sidebar-sub-header"><a href="/fragments/Vue.html#_003-vue-的模版编译过程是怎么样的" class="sidebar-link">003： Vue 的模版编译过程是怎么样的</a></li><li class="sidebar-sub-header"><a href="/fragments/Vue.html#_004-模板编译原理" class="sidebar-link">004： 模板编译原理</a></li><li class="sidebar-sub-header"><a href="/fragments/Vue.html#_005-diff-算法" class="sidebar-link">005： diff 算法</a></li><li class="sidebar-sub-header"><a href="/fragments/Vue.html#_006-虚拟-dom-实现原理-有什么优缺点" class="sidebar-link">006：虚拟 DOM 实现原理，有什么优缺点？</a></li><li class="sidebar-sub-header"><a href="/fragments/Vue.html#_007-key-属性的作用" class="sidebar-link">007： key 属性的作用</a></li><li class="sidebar-sub-header"><a href="/fragments/Vue.html#_008-computed、methods、-watch-区别" class="sidebar-link">008： computed、methods、 watch 区别？</a></li><li class="sidebar-sub-header"><a href="/fragments/Vue.html#_009-filters-与-computed-的区别与用法" class="sidebar-link">009： filters 与 computed 的区别与用法</a></li><li class="sidebar-sub-header"><a href="/fragments/Vue.html#_010-v-show-与-v-if-区别" class="sidebar-link">010： v-show 与 v-if 区别？</a></li><li class="sidebar-sub-header"><a href="/fragments/Vue.html#_011-vue-js-双向绑定原理" class="sidebar-link">011： Vue.js 双向绑定原理</a></li><li class="sidebar-sub-header"><a href="/fragments/Vue.html#_012-keep-alive-组件有什么作用" class="sidebar-link">012： keep-alive 组件有什么作用？</a></li><li class="sidebar-sub-header"><a href="/fragments/Vue.html#_013-vue-组件间通信有哪几种方式" class="sidebar-link">013： Vue 组件间通信有哪几种方式？</a></li><li class="sidebar-sub-header"><a href="/fragments/Vue.html#_014-nexttick-原理分析" class="sidebar-link">014： nextTick 原理分析</a></li><li class="sidebar-sub-header"><a href="/fragments/Vue.html#_015-native-修饰符的作用" class="sidebar-link">015： .native 修饰符的作用</a></li><li class="sidebar-sub-header"><a href="/fragments/Vue.html#_016-父组件可以监听到子组件的生命周期吗" class="sidebar-link">016： 父组件可以监听到子组件的生命周期吗？</a></li><li class="sidebar-sub-header"><a href="/fragments/Vue.html#_016-vue-的单向数据流的理解" class="sidebar-link">016： Vue 的单向数据流的理解</a></li><li class="sidebar-sub-header"><a href="/fragments/Vue.html#_017-vue-事件绑定原理说一下" class="sidebar-link">017： Vue 事件绑定原理说一下</a></li><li class="sidebar-sub-header"><a href="/fragments/Vue.html#_018-mvvm-和-mvc-理解" class="sidebar-link">018： MVVM 和 MVC 理解</a></li><li class="sidebar-sub-header"><a href="/fragments/Vue.html#_019-vue-router-路由模式有几种" class="sidebar-link">019：vue-router 路由模式有几种</a></li><li class="sidebar-sub-header"><a href="/fragments/Vue.html#_020-vue3-0-特性" class="sidebar-link">020： vue3.0 特性</a></li><li class="sidebar-sub-header"><a href="/fragments/Vue.html#_021-vue-的优化" class="sidebar-link">021： Vue 的优化</a></li><li class="sidebar-sub-header"><a href="/fragments/Vue.html#_022-vue-set-的实现原理" class="sidebar-link">022： Vue.set 的实现原理</a></li><li class="sidebar-sub-header"><a href="/fragments/Vue.html#_023-vue-数据渲染过程" class="sidebar-link">023：Vue 数据渲染过程</a></li><li class="sidebar-sub-header"><a href="/fragments/Vue.html#_024-组件更新的过程" class="sidebar-link">024：组件更新的过程</a></li><li class="sidebar-sub-header"><a href="/fragments/Vue.html#_025-为什么-v-for-和-v-if-不能能同时使用" class="sidebar-link">025：为什么 v-for 和 v-if 不能能同时使用</a></li><li class="sidebar-sub-header"><a href="/fragments/Vue.html#_026-为什么组件的-data-是一个函数" class="sidebar-link">026：为什么组件的 data 是一个函数</a></li><li class="sidebar-sub-header"><a href="/fragments/Vue.html#_027-什么是作用域插槽" class="sidebar-link">027：什么是作用域插槽</a></li><li class="sidebar-sub-header"><a href="/fragments/Vue.html#_028-简述-vuex-工作原理" class="sidebar-link">028：简述 vuex 工作原理</a></li><li class="sidebar-sub-header"><a href="/fragments/Vue.html#_029-action-和-mutation-区别" class="sidebar-link">029：action 和 mutation 区别</a></li><li class="sidebar-sub-header"><a href="/fragments/Vue.html#_030-vue-router-导航守卫类型" class="sidebar-link">030：vue-router 导航守卫类型</a></li><li class="sidebar-sub-header"><a href="/fragments/Vue.html#_031-完整的导航解析流程" class="sidebar-link">031：完整的导航解析流程</a></li><li class="sidebar-sub-header"><a href="/fragments/Vue.html#_032-简单聊聊-new-vue-以后发生的事情" class="sidebar-link">032：简单聊聊 new Vue 以后发生的事情</a></li><li class="sidebar-sub-header"><a href="/fragments/Vue.html#_033-模板字符串解析" class="sidebar-link">033：模板字符串解析</a></li></ul></li><li><a href="/fragments/Network.html" class="sidebar-link">🌵 网络</a></li><li><a href="/fragments/JavaScript.html" class="sidebar-link">🌵 JavaScript</a></li><li><a href="/fragments/JavaScript Algorithms.html" class="sidebar-link">🌵 JavaScript 基础算法</a></li><li><a href="/fragments/ES6.html" class="sidebar-link">🌵 ES6</a></li><li><a href="/fragments/CSS.html" class="sidebar-link">🌵 CSS</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="vue"><a href="#vue" class="header-anchor">#</a> 🌵 Vue</h1> <h2 id="_001-vue-生命周期-钩子函数"><a href="#_001-vue-生命周期-钩子函数" class="header-anchor">#</a> 001： Vue 生命周期（钩子函数）</h2> <p>创建阶段： beforeCreate、created、beforeMount、mounted；<br>
更新阶段： beforeUpdate、updated；<br>
销毁阶段： beforeDestory、destroyed；<br>
还有针对来缓存组件状态的 <code>&lt;keep-alive&gt;&lt;/keep-alive&gt;</code> 提供的 activated 和 deactivated。</p> <p>其中最常用的是 beforeCreate 和 created、beforeMount 和 mounted，他们的主要区别是：</p> <ul><li><code>beforeCreate</code>：el 和 data 都未初始化，数据和方法都不能被访问。</li></ul> <ul><li><code>created</code>：组件实例创建完成，属性已经绑定，data 已初始化，el 未初始化（说明可在 created 中首次拿到 data 中定义的数据）。</li></ul> <p>在这里可以拿到 data 数据和更改数据，但不会触发 updated 函数。可以做一些初始数据的获取，在当前阶段无法与 Dom 进行交互，如果非要想，可以通过 <code>vm.$nextTick</code> 来访问 Dom。</p> <ul><li><code>beforeMount</code>：完成 data 和 el 的初始化，template 模板已导入渲染函数编译，但未挂载仍无法获取 DOM。（<code>vm.$mount(el)</code> 会触发这个状态，把 HTML 结构渲染出来，但 vue 实例中的数据没有渲染到 DOM 中，只是利用虚拟 DOM 把坑占住）。</li></ul> <ul><li><code>mounted</code>：el 会被新创建的 <code>vm.$el</code> 替换，即有了 DOM 且完成了双向绑定 可访问 DOM 节点，并挂在是渲染 DOM，完成挂载（说明在 mounted 中 dom 树渲染结束，可访问 dom 结构）。</li></ul> <p>例子：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>vue-test-demo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span>
            <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/javascript<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://cdn.jsdelivr.net/vue/2.1.3/vue.js<span class="token punctuation">&quot;</span></span>
        <span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>{{message}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/javascript<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
            <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">el</span><span class="token operator">:</span> <span class="token string">&quot;#app&quot;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;this is a demo for vue&quot;</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token function-variable function">beforeCreate</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    console<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token string">&quot;beforeCreate 创建前状态 ：&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;el: &quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$el<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;data: &quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$data<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;message: &quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token function-variable function">created</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    console<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token string">&quot;created 创建完成状态 ：&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;el: &quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$el<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;data: &quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$data<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;message: &quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token function-variable function">beforeMount</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    console<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token string">&quot;beforeMount 挂载前状态 ：&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;el: &quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$el<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;data: &quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$data<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;message: &quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token function-variable function">mounted</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    console<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token string">&quot;mounted 挂载完成状态 ：&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;el: &quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$el<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;data: &quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$data<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;message: &quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token function-variable function">beforeUpdate</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    console<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token string">&quot;beforeUpdate 更新前状态 ：&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;el: &quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$el<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$el<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;data: &quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$data<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;message: &quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token function-variable function">updated</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    console<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token string">&quot;updated 更新完成状态 ：&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;el: &quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$el<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$el<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;data: &quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$data<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;message: &quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token function-variable function">beforeDestory</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    console<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token string">&quot;beforeDestory 摧毁前状态 ：&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;el: &quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$el<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;data: &quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$data<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;message: &quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token function-variable function">destoryed</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    console<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token string">&quot;destoryed 摧毁后状态 ：&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;el: &quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$el<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;data: &quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$data<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;message: &quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>输出结果如图：<br> <img src="https://raw.githubusercontent.com/chieminchan/chieminchan.github.io/master/images/interviews/Vue-Lifecycle1.jpg" alt="vue 生命周期图 1"></p> <p><img src="https://raw.githubusercontent.com/chieminchan/chieminchan.github.io/master/images/interviews/Vue-Lifecycle2.jpg" alt="vue 生命周期图 2"></p> <p>其中也可以看出 updated 和 destoryed 前后状态的变化：</p> <ul><li><code>beforeUpdate</code>：可以监听到 data 的变化，但是 view 层的数据没有变化，因此 view 层没有被重新渲染。</li> <li><code>updated</code>：view 层被重新渲染，数据更新。</li> <li><code>beforeDestory</code>：实例销毁之前调用，实例仍可访问可用。</li> <li><code>destoryed</code>：Vue 实例销毁后调用，调用后实例指示的所有东西都会解绑定，所有的事件监听器会被移除，所有的子实例也会被销毁。</li></ul> <p>参考文章：<br> <a href="https://segmentfault.com/a/1190000011381906" target="_blank" rel="noopener noreferrer">详解 vue 生命周期<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="beforecreate-之前做了什么"><a href="#beforecreate-之前做了什么" class="header-anchor">#</a> beforeCreate 之前做了什么</h4> <p>new Vue()创建一个实例后，会调用<code>this._init(options)</code>，并且在外部通过<code>initMixin()、stateMiXin()、eventMixin()、lifeMixin()、renderMixin()</code>去做初始化事件、初始化生命周期的一些操作。</p> <h4 id="混入-mixin-的执行顺序-以及如果有冲突怎么处理的"><a href="#混入-mixin-的执行顺序-以及如果有冲突怎么处理的" class="header-anchor">#</a> 混入 mixin 的执行顺序，以及如果有冲突怎么处理的？</h4> <p>混入 mixin 时，mixin 的生命周期钩子函数执行会优先于组件。</p> <p>当组件和混入对象含有同名选项时，选项将以恰当的方式“合并”：</p> <ul><li><p>钩子函数，created、mounted 等同名钩子函数会合并成一个数组，都将被调用。混入对象钩子函数优先执行（生命周期执行 mixin 先于组件）。</p></li> <li><p>Data 数据，数据对象在内部进行递归合并，并在发生冲突时以组件数据优先；</p></li> <li><p>对象选项：components、methods、directives 等对象，会被合并为同一对象。如果出现了相同键值对，则当前组件中的键具有优先级。</p></li></ul> <h4 id="keep-alive-缓存时的生命周期执行顺序"><a href="#keep-alive-缓存时的生命周期执行顺序" class="header-anchor">#</a> keep-alive 缓存时的生命周期执行顺序</h4> <p>keep-alive 包裹动态组件时，会缓存不活动的组件实例，而不是销毁它们。</p> <p>页面第一次进入，钩子的触发顺序 created-&gt; mounted-&gt; activated，<br>
退出时触发 deactivated，当再次进入（前进或者后退）时，只触发 activated。</p> <h2 id="_002-父子组件挂载顺序是怎么样的"><a href="#_002-父子组件挂载顺序是怎么样的" class="header-anchor">#</a> 002： 父子组件挂载顺序是怎么样的？</h2> <p>加载渲染过程：<br>
父 beforeCreate -&gt; 父 created -&gt; 父 beforedMount -&gt; 子 beforeCreate -&gt; 子 created -&gt; 子 beforedMount -&gt; 子 mounted -&gt; 父 mounted</p> <p>另外关于 updated 和 destroyed 的顺序（从外到内，再从内到外）：</p> <ul><li>子更新： 父 beforeUpdate -&gt; 子 beforeUpdate -&gt; 子 updated -&gt; 父 updated</li> <li>父更新： 父 beforeUpdate -&gt; 父 updated</li> <li>销毁： 父 beforeDestroy -&gt; 子 beforeDestroy -&gt; 子 destroyed -&gt; 父 destroyed</li></ul> <h2 id="_003-vue-的模版编译过程是怎么样的"><a href="#_003-vue-的模版编译过程是怎么样的" class="header-anchor">#</a> 003： Vue 的模版编译过程是怎么样的</h2> <p>普通的 template 或者 el 都是字符串，需要解析成 AST，再将 AST 转化为 render 函数。</p> <p>Vue 的编译过程就是将 template/el 转化为 render 函数的过程。主要会经历以下阶段：</p> <p>（1）解析模版，生成 AST 树(一种用 JavaScript 对象的形式来描述整个模板)<br>
会使用大量的正则表达式对模板进行解析，遇到标签、文本的时候都会执行对应的钩子进行相关处理。</p> <p>（2）优化<br>
优化过程就是深度遍历 AST 树，按照相关条件对树节点进行标记。这些被标记的节点被称为(staticRenderFns） 静态节点，可以不需响应式的结点)。<br>
这是 Vue 在编译过程中的一处优化，后面当 update 更新界面时，会有一个 patch 的过程， diff 算法会直接跳过静态节点，从而减少了比较的过程，优化了 patch 的性能。</p> <p>（3）编译<br>
将 AST 转化成 render function 字符串的过程，得到结果是 render 的字符串以及 staticRenderFns 字符串。</p> <h2 id="_004-模板编译原理"><a href="#_004-模板编译原理" class="header-anchor">#</a> 004： 模板编译原理</h2> <ul><li>解析 html 并生成 AST 语法树；</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/compiler/parse.js</span>

<span class="token comment">// 以下为源码的正则  对正则表达式不清楚的同学可以参考小编之前写的文章(前端进阶高薪必看 - 正则篇);</span>
<span class="token keyword">const</span> ncname <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[a-zA-Z_][\\-\\.0-9_a-zA-Z]*</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span> <span class="token comment">//匹配标签名 形如 abc-123</span>
<span class="token keyword">const</span> qnameCapture <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">((?:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ncname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\\:)?</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ncname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span> <span class="token comment">//匹配特殊标签 形如 abc:234 前面的abc:可有可无</span>
<span class="token keyword">const</span> startTagOpen <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">^&lt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>qnameCapture<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 匹配标签开始 形如 &lt;abc-123 捕获里面的标签名</span>
<span class="token keyword">const</span> startTagClose <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\s*(\/?)&gt;</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span> <span class="token comment">// 匹配标签结束  &gt;</span>
<span class="token keyword">const</span> endTag <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">^&lt;\\/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>qnameCapture<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">[^&gt;]*&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 匹配标签结尾 如 &lt;/abc-123&gt; 捕获里面的标签名</span>
<span class="token keyword">const</span> attribute <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\s*([^\s&quot;'&lt;&gt;\/=]+)(?:\s*(=)\s*(?:&quot;([^&quot;]*)&quot;+|'([^']*)'+|([^\s&quot;'=&lt;&gt;`]+)))?</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span> <span class="token comment">// 匹配属性  形如 id=&quot;app&quot;</span>

<span class="token comment">// match用法：</span>
<span class="token comment">//  let str=&quot;antzone&quot;;  console.log(str.match(&quot;n&quot;));   返回[&quot;n&quot;, index: 1, input: &quot;antzone&quot;, groups: undefined]</span>
<span class="token comment">// （2）数组第一个元素是match方法首次匹配到的子字符串，&quot;antzone&quot;虽然有多个&quot;n&quot;，但是返回的数组只存储首次匹配到的&quot;n&quot;，如果match方法的参数是全局匹配的正则，将会存储所有的匹配到的子字符串。</span>
<span class="token comment">// （3）index属性值返回首次匹配到子字符串的位置。</span>
<span class="token comment">// （4）input属性值是原字符串&quot;antzone&quot;。</span>
<span class="token comment">//  https://www.cnblogs.com/ranyonsue/p/10757567.html</span>

<span class="token keyword">let</span> root<span class="token punctuation">,</span> currentParent<span class="token punctuation">;</span> <span class="token comment">//代表根节点 和当前父节点</span>
<span class="token comment">// 栈结构 来表示开始和结束标签</span>
<span class="token keyword">let</span> stack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// 标识元素和文本type</span>
<span class="token keyword">const</span> <span class="token constant">ELEMENT_TYPE</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">TEXT_TYPE</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token comment">// 生成ast方法</span>
<span class="token keyword">function</span> <span class="token function">createASTElement</span><span class="token punctuation">(</span><span class="token parameter">tagName<span class="token punctuation">,</span> attrs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">tag</span><span class="token operator">:</span> tagName<span class="token punctuation">,</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token constant">ELEMENT_TYPE</span><span class="token punctuation">,</span>
        <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        attrs<span class="token punctuation">,</span>
        <span class="token literal-property property">parent</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 对开始标签进行处理</span>
<span class="token keyword">function</span> <span class="token function">handleStartTag</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> tagName<span class="token punctuation">,</span> attrs <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> element <span class="token operator">=</span> <span class="token function">createASTElement</span><span class="token punctuation">(</span>tagName<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">&quot;将匹配上的match生成ast&quot;</span><span class="token punctuation">,</span> element<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>root<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        root <span class="token operator">=</span> element<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    currentParent <span class="token operator">=</span> element<span class="token punctuation">;</span>
    stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">&quot;ast推入栈&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">...</span>stack<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 对结束标签进行处理</span>
<span class="token keyword">function</span> <span class="token function">handleEndTag</span><span class="token punctuation">(</span><span class="token parameter">tagName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 栈结构 []</span>
    <span class="token comment">// 比如 &lt;div&gt;&lt;span&gt;&lt;/span&gt;&lt;/div&gt; 当遇到第一个结束标签&lt;/span&gt;时 会匹配到栈顶&lt;span&gt;元素对应的ast 并取出来</span>
    <span class="token keyword">let</span> element <span class="token operator">=</span> stack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 当前父元素就是栈顶的上一个元素 在这里就类似div</span>
    currentParent <span class="token operator">=</span> stack<span class="token punctuation">[</span>stack<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// 建立parent和children关系</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>currentParent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        element<span class="token punctuation">.</span>parent <span class="token operator">=</span> currentParent<span class="token punctuation">;</span>
        currentParent<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 对文本进行处理</span>
<span class="token keyword">function</span> <span class="token function">handleChars</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 去掉空格</span>
    text <span class="token operator">=</span> text<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\s</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>text<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        currentParent<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token constant">TEXT_TYPE</span><span class="token punctuation">,</span>
            text<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 解析标签生成ast核心</span>
<span class="token keyword">function</span> <span class="token function">parse</span><span class="token punctuation">(</span><span class="token parameter">html</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>html<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 查找&lt;</span>
        <span class="token keyword">let</span> textEnd <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 如果&lt;在第一个 那么证明接下来就是一个标签 不管是开始还是结束标签</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>textEnd <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 如果开始标签解析有结果</span>
            <span class="token keyword">const</span> startTagMatch <span class="token operator">=</span> <span class="token function">parseStartTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>startTagMatch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 把解析好的标签名和属性解析生成ast</span>
                <span class="token function">handleStartTag</span><span class="token punctuation">(</span>startTagMatch<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// 匹配结束标签&lt;/</span>
            <span class="token keyword">const</span> endTagMatch <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>endTag<span class="token punctuation">)</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token string">&quot;匹配endMAtch&quot;</span><span class="token punctuation">,</span> endTagMatch<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>endTagMatch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">advance</span><span class="token punctuation">(</span>endTagMatch<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">handleEndTag</span><span class="token punctuation">(</span>endTagMatch<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">let</span> text<span class="token punctuation">;</span>
        <span class="token comment">// 形如 3333&lt;/span&gt;&lt;/div&gt;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>textEnd <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 获取文本</span>
            text <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> textEnd<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>text<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">advance</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">handleChars</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 匹配开始标签</span>
    <span class="token keyword">function</span> <span class="token function">parseStartTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> start <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>startTagOpen<span class="token punctuation">)</span><span class="token punctuation">;</span>

        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> html<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>startTagOpen<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// start: [&quot;&lt;div&quot;, &quot;div&quot;, index: 0, input: &quot;&lt;div id=&quot;div1&quot;&gt;&lt;span&gt;3333&lt;/span&gt;&lt;/div&gt;&quot;, groups: undefined]</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>start<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> match <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">tagName</span><span class="token operator">:</span> start<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token literal-property property">attrs</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>

            <span class="token comment">//匹配到了开始标签 就截取掉，方便后续剩下字符的其他操作</span>
            <span class="token function">advance</span><span class="token punctuation">(</span>start<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 开始匹配属性</span>
            <span class="token comment">// end代表结束符号&gt;  如果不是匹配到了结束标签</span>
            <span class="token comment">// attr 表示匹配的属性</span>
            <span class="token comment">// 不断匹配，直到attr匹配完或者end被匹配上了</span>
            <span class="token keyword">let</span> end<span class="token punctuation">,</span> attr<span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>
                <span class="token operator">!</span><span class="token punctuation">(</span>end <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>startTagClose<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
                <span class="token punctuation">(</span>attr <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>attribute<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> end<span class="token punctuation">,</span> attr<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// null, [&quot; id=&quot;div1&quot;&quot;, &quot;id&quot;, &quot;=&quot;, &quot;div1&quot;, undefined, undefined, index: 0, input: &quot; id=&quot;div1&quot;&gt;&lt;span&gt;3333&lt;/span&gt;&lt;/div&gt;&quot;, groups: undefined]</span>

                <span class="token function">advance</span><span class="token punctuation">(</span>attr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>

                attr <span class="token operator">=</span> <span class="token punctuation">{</span>
                    <span class="token literal-property property">name</span><span class="token operator">:</span> attr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">value</span><span class="token operator">:</span> attr<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">||</span> attr<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">||</span> attr<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//这里是因为正则捕获支持双引号 单引号 和无引号的属性值</span>
                <span class="token punctuation">}</span><span class="token punctuation">;</span>

                match<span class="token punctuation">.</span>attrs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>attr<span class="token punctuation">)</span><span class="token punctuation">;</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> match<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>end<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
                    <span class="token number">3</span><span class="token punctuation">,</span>
                    end<span class="token punctuation">,</span>
                    <span class="token string">&quot;如果匹配到了startTagClose返回match&quot;</span><span class="token punctuation">,</span>
                    match
                <span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">//   代表一个标签匹配到结束的&gt;了 代表开始标签解析完毕</span>
                <span class="token function">advance</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> match<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//截取html字符串 每次匹配到了就往前继续匹配</span>
    <span class="token keyword">function</span> <span class="token function">advance</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        html <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//   返回生成的ast</span>
    <span class="token keyword">return</span> root<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 测试例子</span>
<span class="token keyword">const</span> template <span class="token operator">=</span>
    <span class="token string">'&lt;div id=&quot;div1&quot; class=&quot;test&quot;&gt;&lt;span&gt;3333&lt;/span&gt;&lt;input type=&quot;text&quot;/&gt;&lt;/div&gt;'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">parse</span><span class="token punctuation">(</span>template<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>根据 AST 生成代码；</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/compiler/codegen.js</span>
<span class="token keyword">const</span> defaultTagRE <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\{\{((?:.|\\n)+?)\}\}</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">;</span> <span class="token comment">//匹配花括号 {{  }} 捕获花括号里面的内容</span>

<span class="token keyword">function</span> <span class="token function">gen</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 判断节点类型</span>
    <span class="token comment">// 主要包含处理文本核心</span>
    <span class="token comment">// 源码这块包含了复杂的处理  比如 v-once v-for v-if 自定义指令 slot等等  咱们这里只考虑普通文本和变量表达式{{}}的处理</span>

    <span class="token comment">// 如果是元素类型</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//   递归创建</span>
        <span class="token keyword">return</span> <span class="token function">generate</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">//   如果是文本节点</span>
        <span class="token keyword">let</span> text <span class="token operator">=</span> node<span class="token punctuation">.</span>text<span class="token punctuation">;</span>

        <span class="token comment">// 不存在花括号变量表达式</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
            <span class="token string">&quot;1 判断有没有匹配上表达式{{}}&quot;</span><span class="token punctuation">,</span>
            text<span class="token punctuation">,</span>
            defaultTagRE<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">const</span> hasExp <span class="token operator">=</span> <span class="token operator">!</span>defaultTagRE<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>hasExp<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
                <span class="token string">&quot;1-1 没匹配上表达式{{}} 通过_v&quot;</span><span class="token punctuation">,</span>
                text<span class="token punctuation">,</span>
                <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_v(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 正则是全局模式 每次需要重置正则的lastIndex属性  不然会引发匹配bug</span>
        <span class="token keyword">let</span> lastIndex <span class="token operator">=</span> <span class="token punctuation">(</span>defaultTagRE<span class="token punctuation">.</span>lastIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> tokens <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> match<span class="token punctuation">,</span> index<span class="token punctuation">;</span>

        <span class="token comment">// exec的用法：</span>
        <span class="token comment">// var str = &quot;Visit W3School&quot;;  var patt = new RegExp(&quot;W3School&quot;,&quot;g&quot;); var result = patt.exec(str))</span>
        <span class="token comment">// console.log(result, patt.lastIndex)  =&gt;  W3School 14</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>match <span class="token operator">=</span> defaultTagRE<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// match : [&quot;{{myData}}&quot;, &quot;myData&quot;, index: 4, input: &quot;3333{{myData}}&quot;, groups: undefined]</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;1-2 匹配上表达式{{}}&quot;</span><span class="token punctuation">,</span> text<span class="token punctuation">,</span> match<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// index代表匹配到的位置</span>
            index <span class="token operator">=</span> match<span class="token punctuation">.</span>index<span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&gt;</span> lastIndex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 匹配到的{{位置  在tokens里面放入普通文本</span>
                <span class="token comment">// 把 '{{' 之前的文本推入</span>
                tokens<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>lastIndex<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
                    <span class="token string">&quot;2  把{{之前的文本推入&quot;</span><span class="token punctuation">,</span>
                    <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>lastIndex<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token operator">...</span>tokens<span class="token punctuation">]</span>
                <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">//   放入捕获到的变量内容</span>
            tokens<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_s(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>match<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//   匹配指针后移</span>
            lastIndex <span class="token operator">=</span> index <span class="token operator">+</span> match<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 如果匹配完了花括号  text里面还有剩余的普通文本 那么继续push</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>lastIndex <span class="token operator">&lt;</span> text<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            tokens<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>lastIndex<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// _v表示创建文本</span>
        <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_v(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>tokens<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;+&quot;</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 处理attrs属性</span>
<span class="token keyword">function</span> <span class="token function">genProps</span><span class="token punctuation">(</span><span class="token parameter">attrs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> attrs<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> attr <span class="token operator">=</span> attrs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">// 对attrs属性里面的style做特殊处理</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>attr<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">&quot;style&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
            attr<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">let</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span> value<span class="token punctuation">]</span> <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            attr<span class="token punctuation">.</span>value <span class="token operator">=</span> obj<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        str <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>attr<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>attr<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">{</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>str<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">}</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 生成子节点 调用gen函数进行递归创建</span>
<span class="token keyword">function</span> <span class="token function">getChildren</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> children <span class="token operator">=</span> el<span class="token punctuation">.</span>children<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;0 解析每个children&quot;</span><span class="token punctuation">,</span> children<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>children<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>children<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">c</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">gen</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 递归创建生成code</span>
<span class="token keyword">function</span> <span class="token function">generate</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> children <span class="token operator">=</span> <span class="token function">getChildren</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// _c( el.tag, {...el.attrs}, -v(文本内容),  ...children)</span>
    <span class="token comment">// _c代表创建元素 _v代表创建文本 _s代表文Json.stringify--把对象解析成文本</span>
    <span class="token keyword">let</span> code <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_c('</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>el<span class="token punctuation">.</span>tag<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">',</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>
        el<span class="token punctuation">.</span>attrs<span class="token punctuation">.</span>length <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">genProps</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>attrs<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token string">&quot;undefined&quot;</span>
    <span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>children <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>children<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> code<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// ast生成code： _c('div',{id:&quot;div1&quot;,class:&quot;test&quot;}, _v(&quot;13&quot;), _c('span',undefined,_v(&quot;3333{{myData}}&quot;)), _c('input',{type:&quot;text&quot;},_v(&quot;&gt;&quot;)))</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;ast生成code：&quot;</span><span class="token punctuation">,</span> <span class="token function">generate</span><span class="token punctuation">(</span>astNode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>根据 code 字符串转成 render 函数</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">compileToFunctions</span><span class="token punctuation">(</span><span class="token parameter">template</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> code <span class="token operator">=</span> <span class="token function">generate</span><span class="token punctuation">(</span>ast<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 使用with语法改变作用域为this  之后调用render函数可以使用call改变this 方便code里面的变量取值 比如 name值就变成了this.name</span>
    <span class="token keyword">let</span> renderFn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Function</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">with(this){return </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>code<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">}</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> renderFn<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>https://juejin.cn/post/6936024530016010276</p> <h2 id="_005-diff-算法"><a href="#_005-diff-算法" class="header-anchor">#</a> 005： diff 算法</h2> <h2 id="_006-虚拟-dom-实现原理-有什么优缺点"><a href="#_006-虚拟-dom-实现原理-有什么优缺点" class="header-anchor">#</a> 006：虚拟 DOM 实现原理，有什么优缺点？</h2> <p>虚拟 DOM 本质是通过 JS 对象抽离出模拟真实 DOM 的一个树形结构，包含了 tag、props、children 三个属性。(对应源码中的 VNode 类，它定义在 src/core/vdom/vnode.js 中)</p> <p>虚拟 DOM 在 JS 操控 DOM 的过程中进行了一个缓存。</p> <p>使用真实 DOM 对更新的数据重绘整个视图层是相当消耗性能，通过虚拟 DOM 和 diff 算法得出一些需要修改的最小单位，并对小单位的位图作出对应的更新，这样子可以减少不必要的 DOM 操作，以此来提高性能。</p> <p>虚拟 DOM 的优点：1）对粗暴的 DOM 操作进行一个缓存，性能要好；2）无需操作 dom，仅需处理好 ViewModel 代码逻辑，框架会根据虚拟 DOM 和数据双向绑定，更新视图； 3）可跨平台，用于服务端渲染和 weex</p> <p>虚拟 DOM 的缺点：无法进行极致优化</p> <h2 id="_007-key-属性的作用"><a href="#_007-key-属性的作用" class="header-anchor">#</a> 007： key 属性的作用</h2> <p>key 的作用是尽可能的复用 DOM 元素。</p> <p>diff 比对时，一个重要的对比方法 isSameNode，主要根据 vnode 的 tag、key 两个属性判断两个节点是否相同 (isSameNode 函数)，适当的 key 配置能够有效提高 DOM 复用率，降低 DOM 节点重建频率来提高运行性能。</p> <p>同时在 updateChildren 的阶段，key 也就是 children 中节点的唯一标识。通过 key 建立新旧结点的映射关系，以便能够在旧孩子结点中找到可以复用的结点，降低重建开销。</p> <h2 id="_008-computed、methods、-watch-区别"><a href="#_008-computed、methods、-watch-区别" class="header-anchor">#</a> 008： computed、methods、 watch 区别？</h2> <h4 id="methods"><a href="#methods" class="header-anchor">#</a> methods</h4> <p>不具备缓存能力，也非响应式，只能是作为事件处理函数，被动调用。</p> <h4 id="computed"><a href="#computed" class="header-anchor">#</a> computed</h4> <p>1）computed 可以当作一个属性来用；</p> <p>2）具有缓存能力，默认不执行除非被访问；<br>
3）响应式的，当它依赖的属性变化时，它会主动执行，进行响应式更新。</p> <ul><li><p>计算属性具有缓存原因<br>
computed  会拥有自己的  watcher。</p> <p>初始化时传入 lazy 属性表明是 computed 对应的订阅者，lazy 首次不执行，然后也会对应生成一个 dirty 属性，初始值为 true。</p> <p>它内部有个属性  dirty  开关来决定  computed  的值是需要重新计算还是直接复用之前的值。</p> <p>dirty 打开时，会调用 watcher.evaluate（重新去求值，后关闭 dirty），否则返回旧值。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">computed</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在 sum 第一次进行求值的时候会读取响应式属性 count，收集到这个响应式数据作为依赖。并且计算出一个值来保存在自身的 value 上，把 dirty 设为 false，接下来在模板里再访问 sum 就直接返回这个求好的值 value，并不进行重新的求值。</p> <p>而 count 发生变化了以后会通知 sum 所对应的 watcher 把自身的 dirty 属性设置成 true，这也就相当于把重新求值的开关打开来了。这个很好理解，只有 count 变化了， sum 才需要重新去求值。</p> <p>那么下次模板中再访问到 this.sum 的时候，才会真正的去重新调用 sum 函数求值，并且再次把 dirty 设置为 false，等待下次的开启……</p></li> <li><p>计算属性如何收集依赖<br>
当 computed 作为一个属性被使用时会为他收集依赖，其实它依赖于 data 属性变化而变化，因此帮 computed 收集依赖相对于帮所依赖的 data 属性收集依赖，所以这个 watcher 对象里面会维护一个 dep 存储给哪些发布者所订阅了，然后为依赖属性 dep 中放入自己这个 watcher。</p> <p>computed 在组件内普适性更强，因此适用于复杂的数据转换、统计等场景；一个数据受多个数据影响时使用。</p></li></ul> <h4 id="watch"><a href="#watch" class="header-anchor">#</a> watch</h4> <p>1）初始化时默认会执行一次<br>
2）响应式的，属性一变化就会触发对应的回调函数<br>
3）一般一个数据影响多个数据时使用</p> <p>4）当需深度监听时，可设置<code>deep：true</code>，这样便会对对象每一项属性进行监听。但是这样会带来性能问题，优化的话可以使用字符串形式监听。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 优化前</span>
<span class="token literal-property property">watch</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">obj</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function">handler</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'obj has changed to '</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">immediate</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">deep</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 优化后</span>
<span class="token literal-property property">watch</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">'obj.a'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function">handler</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'obj.a has changed to '</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">immediate</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>computed 和 watch 的应用场景：<br>
当我们需要进行数值计算，并且依赖于其它数据时，应该使用 computed，可利用 computed 的缓存特性，避免每次获取值时都重新计算；</p> <p>当我们需要在数据变化时执行异步或开销较大的操作时，应该使用 watch，使用 watch 选项允许我们执行异步操作 ( 访问一个 API )，限制我们执行该操作的频率，并在我们得到最终结果前，设置中间状态。这些都是计算属性无法做到的。</p> <p>https://blog.csdn.net/weixin_46837985/article/details/106632342</p> <p>https://www.imooc.com/article/14466</p> <p>https://segmentfault.com/a/1190000021761594</p> <h2 id="_009-filters-与-computed-的区别与用法"><a href="#_009-filters-与-computed-的区别与用法" class="header-anchor">#</a> 009： filters 与 computed 的区别与用法</h2> <h4 id="filters"><a href="#filters" class="header-anchor">#</a> filters</h4> <p>1）不具备缓存和响应功能，显式调用时触发，一般应用在模板渲染上。</p> <p>2）优点是可链式调用，容易在组件外抽象；<br>
缺点是每次模板渲染时都需要重新执行计算</p> <p>3）filter 有两种定义方式：<br>
一是在组件内部通过 filters 属性定义；<br>
一是在组件外部通过 Vue.filter 函数定义：</p> <h2 id="_010-v-show-与-v-if-区别"><a href="#_010-v-show-与-v-if-区别" class="header-anchor">#</a> 010： v-show 与 v-if 区别？</h2> <ul><li><p><code>v-if</code> 是真正的条件渲染，根据判断条件来动态的进行增删 DOM 元素。如果初始渲染时条件为假则什么都不做，直至条件为真时才开始渲染。</p></li> <li><p><code>v-show</code> 不管初始条件是什么，元素总会被渲染，通过<code>display: none</code>隐藏起来。</p></li></ul> <p>v-if 适用于在运行时很少改变条件，不需要频繁切换条件的场景；v-show 则适用于需要非常频繁切换条件的场景。</p> <h2 id="_011-vue-js-双向绑定原理"><a href="#_011-vue-js-双向绑定原理" class="header-anchor">#</a> 011： Vue.js 双向绑定原理</h2> <p>Vue 双向绑定是指数据（Model）和视图（View）同步更新的一个过程，即数据从 DOM 到 JS 和从 JS 到 DOM 监测并同步更新的过程。</p> <p>从 DOM 到 JS 的过程通常用 addEventListener 去监测 DOM 的事件行为进而触发 JS 的数据变化。</p> <p>那如何检测 JS 数据对象属性发生变化 进而同步更新视图呢？</p> <p>这个主要采用<strong>数据劫持</strong>结合<strong>发布者-订阅者模式</strong>的方式，通过<code>Object.defineProperty()</code>来劫持各个属性的 setter，getter，在数据变动时发布消息给订阅者，然后触发相应的监听回调。</p> <ol><li>第一步，在组件初始化，通过 Observer(数据监听器)，遍历 data 里面的每个属性对象，为他们绑定一个专用的 Dep 对象（发布者），并且通过 <code>Object.defineProperty</code> 重写数据的 getter 和 setter，劫持监听属性。</li></ol> <p>getter 会收集依赖，Setter 会更新依赖，在属性更新后触发 dep.notify 去通知所有依赖。</p> <ol start="2"><li><p>第二步，会对 props、computed、watch 创建 watcher：<br>
1）调用 initComputed ，将 computed 属性转化为 watcher 实例；<br>
2）调用 initWatcher，将 watcher 配置属性转化为 watcher 实例；<br>
3）调用 mountComponent，将 render 函数绑定 watcher 实例；</p> <p>其中，Watcher 要做的事情：<br>
1）强制执行 getter，把自己添加进属性订阅池里；<br>
2）编写 update 方法，在 dep.notify 里触发 watcher.update 方法后（通过 compile 绑定的更新回调）更新视图。</p></li> <li><p>第三步，通过 Compile 遍历节点：<br>
1）替换模版变量，初始化页面；<br>
2）对节点绑定函数事件（v-bind on-click..遍历所有节点及其子节点，进行扫描解析编译，调用对应的指令渲染函数进行数据渲染，并调用对应指令更新函数（vm.$options.methods[exp]）进行绑定）</p></li></ol> <h4 id="怎么实现对数组的监听"><a href="#怎么实现对数组的监听" class="header-anchor">#</a> 怎么实现对数组的监听？</h4> <p>以下情况 vue 会对数组无法监听：</p> <p>（1）利用索引直接设置一个数组项时，例如：vm.items[indexOfItem] = newValue<br>
（2）修改数组的长度时，例如：vm.items.length = newLength<br>
（3）push、pop 一些特殊的方法也不能触发 setter</p> <p>vue 主要通过修改重新原型上的 push，pop，shift，unshift，splice, sort，reverse 七个方法，去监听造成数组变化的方法，触发这个方法的同时去调用挂载好的响应页面方法，达到页面响应式的效果。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 监听函数</span>

<span class="token comment">// 记录原始Array未重写之前的API原型方法</span>
<span class="token keyword">const</span> arrayProto <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">;</span>

<span class="token comment">// 拷贝一份上面的原型出来</span>
<span class="token keyword">const</span> arrayMethods <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>arrayProto<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 将要重写的方法</span>
<span class="token keyword">const</span> methodsToPatch <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;push&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;pop&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;shift&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;unshift&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;splice&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;sort&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;reverse&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * Intercept mutating methods and emit events
 */</span>
methodsToPatch<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">method</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">def</span><span class="token punctuation">(</span>arrayMethods<span class="token punctuation">,</span> method<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">mutator</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 原有的数组方法调用执行</span>
        <span class="token keyword">const</span> result <span class="token operator">=</span> arrayProto<span class="token punctuation">[</span>method<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">const</span> ob <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__ob__<span class="token punctuation">;</span>

        <span class="token keyword">let</span> inserted<span class="token punctuation">;</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>method<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token string">&quot;push&quot;</span><span class="token operator">:</span>
            <span class="token keyword">case</span> <span class="token string">&quot;unshift&quot;</span><span class="token operator">:</span>
                inserted <span class="token operator">=</span> args<span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token string">&quot;splice&quot;</span><span class="token operator">:</span>
                inserted <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 如果是插入的数据，将其再次监听起来</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>inserted<span class="token punctuation">)</span> ob<span class="token punctuation">.</span><span class="token function">observeArray</span><span class="token punctuation">(</span>inserted<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 触发订阅，像页面更新响应就在这里触发</span>
        ob<span class="token punctuation">.</span>dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 改变数组里的元素不能监听到，但是数组内的值是对象类型的，修改它依旧能得到监听响应</span>
<span class="token comment">// 如改变list[0].val可以得到监听，但是改变list[0]不能，但是依旧没有对数组本身的变化进行监听。</span>
<span class="token function">observeArray</span> <span class="token punctuation">(</span><span class="token parameter">items</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> items<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 监听数组元素</span>
    <span class="token function">observe</span><span class="token punctuation">(</span>items<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="双向绑定的实现"><a href="#双向绑定的实现" class="header-anchor">#</a> 双向绑定的实现</h4> <p>👉 更详细的<a href="https://chieminchan.vercel.app/articles/Vue/Vue%20%E7%9A%84%E5%8F%8C%E5%90%91%E7%BB%91%E5%AE%9A.html" target="_blank" rel="noopener noreferrer">戳我<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="_012-keep-alive-组件有什么作用"><a href="#_012-keep-alive-组件有什么作用" class="header-anchor">#</a> 012： keep-alive 组件有什么作用？</h2> <p><code>&lt;keep-alive&gt;</code>是 vue 内置的一个组件，一般结合路由和动态组件一起使用，主要作用是缓存组件，使被包含的组件保留状态，避免重新渲染加载。</p> <p>它的 prop 属性值分别有 include 和 exclude ，分别表示只有匹配名称的组件需要缓存和不会被缓存。优先级 exclude 较高。</p> <p>对应两个钩子函数：当组件被激活时，触发钩子函数 activated，当组件被移除时，触发钩子函数 deactivated，下一次进入时只会触发 activated。</p> <blockquote><p>keep-alive 的中还运用了 LRU(Least Recently Used)算法。</p></blockquote> <h2 id="_013-vue-组件间通信有哪几种方式"><a href="#_013-vue-组件间通信有哪几种方式" class="header-anchor">#</a> 013： Vue 组件间通信有哪几种方式？</h2> <p>https://www.cnblogs.com/mengfangui/p/9995470.html</p> <p>https://juejin.im/post/5d59f2a451882549be53b170#heading-16</p> <ul><li><p><code>prop / $emit</code> ：适合父子间通信</p></li> <li><p><code>ref / $parents / $children</code>： 适合父子间通信</p></li></ul> <p><code>ref = 'xxx'</code> 被用来给元素或子组件注册引用信息。引用信息将会注册在父组件的 <code>$refs</code> 对象上。如果在普通的 DOM 元素上使用，引用指向的就是 DOM 元素；如果用在子组件上，引用就指向组件实例。</p> <p><code>$parent / $children</code> 分别指向当前实例的直接父组件（如果没有父实例则指向自己）和子组件。</p> <ul><li><code>eventBus （$emit / $on）</code>：适合任何组件间通信</li></ul> <p>公共事件总线<code>eventBus</code>的本质是创建一个空的 vue 实例作为桥梁（事件中心），实现任何组件间的通信。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 注册一个全局的事件总线</span>
<span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$eventBus <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 兄弟组件A（A发送aClick事件）</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$eventBus<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">&quot;aClick&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">&quot;i am a msg from brotherA&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 兄弟组件B（B监听aClick事件）</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$eventBus<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">&quot;aClick&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 兄弟A发来的事件</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>msgFromA <span class="token operator">=</span> msg<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><code>$attrs / $listeners</code> 适合多级嵌套组件间通信（vue2.4 新增属性）</li></ul> <p><code>$attrs / $listeners</code> 可作为解决多级组件嵌套，需要组件通过<code>prop</code>和<code>$emit</code>中转情况的优化方案。</p> <p><code>$attrs</code> 继承所有的父组件属性（除了通过 prop 传递的属性、class 和 style），通常配合 inheritAttrs 选项一起使用。<code>inheritAttrs：true</code>时，子组件可通过<code>$attrs</code>获取到除 props 之外的所有属性；<code>inheritAttrs：false</code> 只继承 class 属性。</p> <p>父组件 A 把很多数据传给子组件 B，子组件 B 利用<code>$attrs</code>收集起来，然后可以利用 <code>v-bind=&quot;$attrs&quot;</code> 传给 B 的子组件 C（也就是 A 组件的孙组件），这样就不用一个一个属性去传了。</p> <p><code>$listeners</code> 与 <code>$attrs</code> 类似，<code>$listeners</code> 传递的是事件，可接收除了带 <code>.native</code> 事件修饰符的所有事件监听器，通过 <code>v-on=&quot;$listeners&quot;</code>将所有事件监听器传入当前组件的内部组件。内部组件可通过 <code>$emit</code> 触发事件。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Father.vue</span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;father&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Child <span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">&quot;name&quot;</span> <span class="token operator">:</span>age<span class="token operator">=</span><span class="token string">&quot;age&quot;</span> <span class="token operator">:</span>weight<span class="token operator">=</span><span class="token string">&quot;weight&quot;</span> @updateInfo<span class="token operator">=</span><span class="token string">&quot;updateInfo&quot;</span> @click<span class="token punctuation">.</span>native<span class="token operator">=</span><span class="token string">'clickHandler'</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Child<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
    <span class="token keyword">import</span> Child <span class="token keyword">from</span> <span class="token string">'./Child.vue'</span><span class="token punctuation">;</span>

    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'father'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token punctuation">{</span> Child <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'father'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
                <span class="token literal-property property">weight</span><span class="token operator">:</span> <span class="token number">50</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token function">updateInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'father A: update info'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token function">clickHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'father A: click handler'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

<span class="token comment">// Son.vue</span>
 <span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;son&quot;</span><span class="token operator">&gt;</span>
        <span class="token comment">// son 组件将继承父作用域的属性传至其自身的子组件（即 GrandSon ）</span>
        <span class="token comment">// son 组件将接收到父作用域的事件监听器传至自身的子组件（即 GrandSon ）</span>
        <span class="token operator">&lt;</span>GrandSon v<span class="token operator">-</span>bind<span class="token operator">=</span><span class="token string">'$attrs'</span> v<span class="token operator">-</span>on<span class="token operator">=</span><span class="token string">'$listerners'</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>GrandSon<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
    <span class="token keyword">import</span> GrandSon <span class="token keyword">from</span> <span class="token string">'./GrandSon.vue'</span><span class="token punctuation">;</span>

    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'son'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token punctuation">{</span>GrandSon<span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">inheritAttrs</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//父组件共传来三个值，name、age、weight，由于 name 被 props 接收了，故 $attrs 只包括 age 、weight 属性</span>
            <span class="token comment">//{age: 30, weight: 50}</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$attrs<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//父组件监听了两个事件，updateInfo和click，由于click被native修饰了，故$listerners 只有 updateInfo 事件</span>
            <span class="token comment">// {updateInfo: fn}</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$listener<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

<span class="token comment">// GrandSon.vue</span>
 <span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;grandson&quot;</span><span class="token operator">&gt;</span>
        <span class="token punctuation">{</span><span class="token punctuation">{</span> $attrs <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> $listeners <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
    <span class="token keyword">import</span> GrandSon <span class="token keyword">from</span> <span class="token string">'./GrandSon.vue'</span><span class="token punctuation">;</span>

    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'son'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token punctuation">{</span>GrandSon<span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">inheritAttrs</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//{age: 30, weight: 50}</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$attrs<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// {updateInfo: fn}</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$listener<span class="token punctuation">)</span><span class="token punctuation">;</span>

             <span class="token comment">// 可触发 father 组件中的updateInfo函数</span>
             <span class="token comment">// father A: update info</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'updateInfo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><ul><li><code>provide / inject</code> 适用于隔代组件通信（vue2.2 新增属性）</li></ul> <p>在祖先组件中可通过 <code>provide</code> 指定我们想要提供给后代组件的数据或方法，而在任何后代组件中，我们都可以使用 <code>inject</code> 来注入 <code>provide</code> 提供的数据或方法。</p> <p><code>provide / inject</code> API 主要解决了跨级组件间的通信问题，不过它的使用场景，主要是子组件获取上级组件的状态，跨级组件间建立了一种主动提供与依赖注入的关系。</p> <blockquote><p>provide 和 inject 绑定并不是可响应的。这是刻意为之的。然而，如果你传入了一个可监听的对象，那么其对象的属性还是可响应的。</p></blockquote> <p>详情戳<a href="https://juejin.im/post/5dc4cbeff265da4d1f51c7f1" target="_blank" rel="noopener noreferrer">这<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li><code>Vuex</code> 适用于所有组件间通信</li></ul> <p>Vuex 是一个 Vue.js 的状态管理模式。每一个 Vuex 应用的核心就是 store（仓库）。</p> <p><code>store</code>基本上就是一个容器，它包含着你的应用中大部分的状态 <code>state</code>。</p> <p>Vuex 的状态存储是响应式的。当 Vue 组件从 store 中读取状态的时候，若 store 中的状态发生变化，那么相应的组件也会相应地得到高效更新。</p> <p>改变 store 中的状态的唯一途径就是显式地提交 (commit) mutation。这样使得我们可以方便地跟踪每一个状态的变化。</p> <h2 id="_014-nexttick-原理分析"><a href="#_014-nexttick-原理分析" class="header-anchor">#</a> 014： nextTick 原理分析</h2> <blockquote><p>在下次 DOM 更新循环结束之后执行延迟回调。在修改数据之后立即使用这个方法，获取更新后的 DOM。</p></blockquote> <p>简单来说：<br>
DOM 至少会在当前 tick 里面的代码全部执行完毕后再更新。所以不可能做到在修改数据后 DOM 马上更新，要保证在 DOM 更新以后再执行某一块代码，就必须把这块代码放到下一次事件循环里面，比如 setTimeout(fn, 0)，这样 DOM 更新后，就会立即执行这块代码。</p> <p>应用场景：</p> <ol><li><p>在 Vue 生命周期的 created()钩子函数进行的 DOM 操作一定要放在 Vue.nextTick()的回调函数中。<br>
原因：是 created()钩子函数执行时 DOM 其实并未进行渲染。</p></li> <li><p>在数据变化后要执行的某个操作，而这个操作需要使用随数据改变而改变的 DOM 结构的时候，这个操作应该放在 Vue.nextTick()的回调函数中。<br>
原因：Vue 异步执行 DOM 更新，只要观察到数据变化，Vue 将开启一个队列，并缓冲在同一事件循环中发生的所有数据改变，如果同一个 watcher 被多次触发，只会被推入到队列中一次。</p></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 点击按钮显示原本以 v-show = false 隐藏起来的输入框，并获取焦点。</span>
<span class="token function">showsou</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>showit <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token comment">//修改 v-show</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;keywords&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">//在第一个 tick 里，获取不到输入框，自然也获取不到焦点</span>
<span class="token punctuation">}</span>

<span class="token comment">// 需要修改成</span>
<span class="token function">showsou</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>showit <span class="token operator">=</span> <span class="token boolean">true</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// DOM 更新了</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;keywords&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>myWidth<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>showMe<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{ message }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>getMyWidth<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>获取p元素宽度<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token function">getMyWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>showMe <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token comment">//this.message = this.$refs.myWidth.offsetWidth;</span>
        <span class="token comment">//报错 TypeError: this.$refs.myWidth is undefined</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token comment">//dom元素更新后执行，此时能拿到p元素的属性</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>message <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>myWidth<span class="token punctuation">.</span>offsetWidth<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>nextTick 主要使用了宏任务和微任务。根据执行环境分别尝试采用:Promise、MutationObserver、setImmediate，如果以上都不行则采用 setTimeout。即延迟调用优先级如下：<code>Promise &gt; MutationObserver &gt; setImmediate &gt; setTimeout</code>。</p> <p>定义了一个异步方法，多次调用 nextTick 会将方法存入队列中，通过这个异步方法清空当前队列。</p> <p><code>this.a = 'test</code> 当修改了一个属性以后，会触发以下步骤：</p> <ol><li><p>进入 a 的 setter，通知所有订阅 a 属性的 watcher；</p></li> <li><p>watcher 收到通知以后，会将自己放入更新数组 （<a href="https://github.com/vuejs/vue/blob/2bff588ce8/src/core/observer/watcher.js#L171" target="_blank" rel="noopener noreferrer">queueWatcher<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>）</p></li></ol> <p>接着执行 <code>nextTick(flushSchedulerQueue)</code>,flushSchedulerQueue 函数主要作用是执行更新数组。</p> <p>接着进入<a href="https://github.com/vuejs/vue/blob/2bff588ce8/src/core/util/next-tick.js" target="_blank" rel="noopener noreferrer">next-tick.js 对外暴露的 nextTick<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>：</p> <ol start="3"><li><p>把传入的回调函数 cb （flushSchedulerQueue）压入 callbacks 数组；</p></li> <li><p>执行 timerFunc 函数（决定何时调用），延迟调用 flushCallbacks 函数（优先级：<code>Promise &gt; MutationObserver &gt; setImmediate &gt; setTimeout</code>）</p></li> <li><p>执行 flushCallbacks 函数，即执行 callbacks 数组里面的所有 cb 回调</p></li> <li><p>这里的 callbacks 没有直接在 nextTick 中执行回调函数的原因是保证在同一个 tick 内多次执行 nextTick，不会开启多个异步任务，而是把这些异步任务都压成一个同步任务，在下一个 tick 执行完毕。</p></li></ol> <p>每次调用 Vue.nextTick 时会执行其中 （3-6） 步骤。</p> <blockquote><p>Vue 异步执行 DOM 更新。只要观察到数据变化，Vue 将开启一个队列，并缓冲在同一事件循环中发生的所有数据改变。如果同一个 watcher 被多次触发，只会被推入到队列中一次。这种在缓冲时去除重复数据对于避免不必要的计算和 DOM 操作上非常重要。然后，在下一个的事件循环“tick”中，Vue 刷新队列并执行实际 (已去重的) 工作。</p></blockquote> <blockquote><p>如果 Vue 使用 setTimeout 等宏任务函数，那么势必要等待 UI 渲染完成后的下一个宏任务执行。如果 Vue 使用微任务函数，无需等待 UI 渲染完成才进行 nextTick 的回调函数操作，可以想象在 JS 引擎线程和 GUI 渲染线程之间来回切换，以及等待 GUI 渲染线程的过程中，浏览器势必要消耗性能，这是一个严谨的框架完全需要考虑的事情。</p></blockquote> <p>更详细可以参考，子奕大大的文章<a href="https://juejin.cn/post/6844903843197616136" target="_blank" rel="noopener noreferrer">《你真的理解$nextTick 么》<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="_015-native-修饰符的作用"><a href="#_015-native-修饰符的作用" class="header-anchor">#</a> 015： .native 修饰符的作用</h2> <p>对组件绑定 DOM 事件时，可通过<code>.native</code>修饰。在父实例解析完毕开始挂载时，遇到子元素是组件，然后去解析组件内部并生成 DOM 之后才 addEventListener 绑定。绑定的原生事件，会被存放在组件的外壳节点上 <code>vm.$vnode</code>。</p> <p><code>.native</code> 主要用于<strong>监听组件根元素的原生事件</strong>，<strong>给自定义的组件添加原生事件</strong>。</p> <p>值得注意的是：加了 native 相当于把自定义组件看成了 html 元素可以直接监听原生 click 事件；否则在自定义组件上 绑定的事件 默认是 自定义事件，而如果在自定义组件上没有定义这个事 件，不加 native 不会执行。</p> <p>例子：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Button.vue</span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
   <span class="token operator">&lt;</span>button type<span class="token operator">=</span><span class="token string">&quot;button&quot;</span> v<span class="token operator">-</span>on<span class="token operator">:</span>click<span class="token operator">=</span><span class="token string">&quot;clickHandler&quot;</span><span class="token operator">&gt;</span>
       <span class="token operator">&lt;</span>slot<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>slot<span class="token operator">&gt;</span>
   <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
   <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
       <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
           <span class="token function">clickHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">&quot;vclick&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 触发 vclick 事件</span>
           <span class="token punctuation">}</span>
       <span class="token punctuation">}</span>
   <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><p>原生 html 标签绑定事件，通过 addEventListener 绑定 DOM 事件，事件会被保存在这个节点解析成的 vnode 中，就是 <code>vm._vnode</code>。</p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token comment">// 引用 Button.vue 的组件作为&lt;VButton&gt;</span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;a&quot;</span><span class="token operator">&gt;</span>

        <span class="token comment">// 如果不添加native修饰click，会被认为没有注册自定义元素的自定义事件click对应的处理函数。但会执行vClickHandler</span>
        <span class="token operator">&lt;</span>vButton v<span class="token operator">-</span>on<span class="token operator">:</span>click<span class="token operator">=</span><span class="token string">&quot;clickHandler&quot;</span> v<span class="token operator">-</span>on<span class="token operator">:</span>vclick<span class="token operator">=</span><span class="token string">&quot;vClickHandler&quot;</span><span class="token operator">&gt;</span> 按钮<span class="token number">1</span> <span class="token operator">&lt;</span><span class="token operator">/</span>vButton<span class="token operator">&gt;</span>

        <span class="token comment">// clickHandler 和 vclickHanddler 都会执行</span>
        <span class="token operator">&lt;</span>vButton v<span class="token operator">-</span>on<span class="token operator">:</span>click<span class="token punctuation">.</span>native<span class="token operator">=</span><span class="token string">&quot;clickHandler&quot;</span> v<span class="token operator">-</span>on<span class="token operator">:</span>vclick<span class="token operator">=</span><span class="token string">&quot;vClickHandler&quot;</span><span class="token operator">&gt;</span>按钮<span class="token number">2</span><span class="token operator">&lt;</span><span class="token operator">/</span>vButton<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
    <span class="token keyword">import</span> vButton <span class="token keyword">from</span> <span class="token string">&quot;./Button.vue&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token function">vClickHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 自定义事件</span>
                cconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;in v-click&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token function">clickHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// dom事件</span>
                cconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;in on-click&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><h2 id="_016-父组件可以监听到子组件的生命周期吗"><a href="#_016-父组件可以监听到子组件的生命周期吗" class="header-anchor">#</a> 016： 父组件可以监听到子组件的生命周期吗？</h2> <p>可以，可通过<code>$emit</code>实现，但这个方式需要通过手动触发，也可以通过 hook 解决。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 在父组件中 @hook:钩子</span>
<span class="token comment">//  Parent.vue</span>
<span class="token operator">&lt;</span>Child @hook<span class="token operator">:</span>mounted<span class="token operator">=</span><span class="token string">&quot;doSomething&quot;</span> <span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Child<span class="token operator">&gt;</span>

<span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'父组件监听到 mounted 钩子函数 ...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token comment">//  Child.vue</span>
<span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'子组件触发 mounted 钩子函数 ...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token comment">// 以上输出顺序为：</span>
<span class="token comment">// 子组件触发 mounted 钩子函数 ...</span>
<span class="token comment">// 父组件监听到 mounted 钩子函数 ...</span>
</code></pre></div> <h2 id="_016-vue-的单向数据流的理解"><a href="#_016-vue-的单向数据流的理解" class="header-anchor">#</a> 016： Vue 的单向数据流的理解</h2> <p>父组件可以通过设置子组件的属性（Props）来向子组件传递数据，而父组件想获得子组件的数据，需要向子组件注册事件，在子组件通过<code>$emit</code>触发这个事件把数据传递出来。即 Props 向下传递数据，事件向上传递数据。</p> <p>这样子做的意义是为了避免子组件不经意改变了父组件传来的数据，导致不确定数据的流向处理。</p> <h2 id="_017-vue-事件绑定原理说一下"><a href="#_017-vue-事件绑定原理说一下" class="header-anchor">#</a> 017： Vue 事件绑定原理说一下</h2> <p>原生事件绑定是通过 addEventListener 绑定给真实元素的，组件事件绑定是通过 Vue 自定义的 <code>$on</code> 实现的。如果要在组件上使用原生事件，需要添加<code>.native</code> 去修饰，这样子相当于在伏组件中把子组件当做是普通 html，然后加上原生事件。</p> <h2 id="_018-mvvm-和-mvc-理解"><a href="#_018-mvvm-和-mvc-理解" class="header-anchor">#</a> 018： MVVM 和 MVC 理解</h2> <h4 id="mvc"><a href="#mvc" class="header-anchor">#</a> MVC</h4> <ul><li>Model（模型）：是应用程序中用于处理应用程序数据逻辑的部分。通常模型对象负责在数据库中存取数据</li> <li>View（视图）：是应用程序中处理数据显示的部分。通常视图是依据模型数据创建的</li> <li>Controller（控制器）：是应用程序中处理用户交互的部分。通常控制器负责从视图读取数据，控制用户输入，并向模型发送数据。</li></ul> <p>Model 层与 View 层耦合，交互形成一个回路：<br>
流程：用户操作 -&gt; View（负责接收用户的输入操作） -&gt; Controller（业务逻辑处理） -&gt; Model（数据处理）-&gt; View（将结果反馈给 View）。</p> <h4 id="mvvm"><a href="#mvvm" class="header-anchor">#</a> MVVM</h4> <ul><li><p>View 层：视图层，也就是用户界面。前端主要由 HTML 和 CSS 来构建 。</p></li> <li><p>Model 层：数据模型，泛指后端进行的各种业务逻辑处理和数据操控，对于前端来说就是后端提供的 api 接口。</p></li> <li><p>ViewModel 层：做了两件事达到了数据的双向绑定：<br>
一是将【模型】转化成【视图】，即将后端传递的数据转化成所看到的页面。实现的方式是：数据绑定。<br>
二是将【视图】转化成【模型】，即将所看到的页面转化成后端的数据。实现的方式是：DOM 事件监听。</p></li></ul> <p>MVVM 框架实现了 View 和 Model 的自动同步，也就是当 Model 的属性改变时，我们不用再自己手动操作 Dom 元素，来改变 View 的显示，而是改变属性后该属性对应 View 层显示会自动改变（对应 Vue 数据驱动的思想）</p> <p>这样 View 层展现的不是 Model 层的数据，而是 ViewModel 的数据，由 ViewModel 负责与 Model 层交互，这就完全解耦了 View 层和 Model 层，这个解耦是至关重要，是前后端分离方案实施的重要一环。</p> <p>用 Vue 的视角来解释 MVVM 的话，View 视图对应的是 Vue 的模板和样式表；而 ViewModel 则是该组件的实例，每个组件的作用域都是独立的，互不影响；而 Vue 的 Model 层，在没有引入第三方状态管理的情况下，就是指组件中 data 属性中的内容。如果系统中引入了全局的 Model 层，比如 vuex，那 Model 层也包含一个和 Vue 组件脱离的对象。</p> <h2 id="_019-vue-router-路由模式有几种"><a href="#_019-vue-router-路由模式有几种" class="header-anchor">#</a> 019：vue-router 路由模式有几种</h2> <p>vue-router 路由模式主要有两种：hash 和 history。</p> <h4 id="常用的-hash-和-history-路由模式实现原理"><a href="#常用的-hash-和-history-路由模式实现原理" class="header-anchor">#</a> 常用的 hash 和 history 路由模式实现原理</h4> <h2 id="_020-vue3-0-特性"><a href="#_020-vue3-0-特性" class="header-anchor">#</a> 020： vue3.0 特性</h2> <ol><li>监测机制的改变</li></ol> <p>基于 Proxy 实现数据劫持，消除了 Vue 2 基于 Object.defineProperty 的实现所存在的很多限制：</p> <ul><li>监测对象；检测属性的添加和删除；</li> <li>检测数组索引和长度的变更；支持 Map、Set、WeakMap 和 WeakSet。</li></ul> <ol start="2"><li>Composition API</li></ol> <p>Vue 3 推出了 Composition API ，Composition API 是以函数的形式封装公共逻辑，它通过显式的返回一个对象，让开发人员能在组件中直接了解到被引入的字段，从而避免 Mixin 命名冲突。</p> <ol start="3"><li>虚拟 DOM 优化和 diff 算法优化</li></ol> <h2 id="_021-vue-的优化"><a href="#_021-vue-的优化" class="header-anchor">#</a> 021： Vue 的优化</h2> <h4 id="代码层面的优化"><a href="#代码层面的优化" class="header-anchor">#</a> 代码层面的优化</h4> <ul><li><p>减少 data 数据，或者对不该动的属性采用<code>Object.freeze</code>，否则数据都会增加 getter 和 setter，会收集对应的 watcher</p></li> <li><p>v-if 和 v-show 区分使用场景</p></li> <li><p>v-for 遍历必须为 item 添加 key，且避免同时使用 v-if</p></li> <li><p>computed 和 watch 区分使用场景</p></li> <li><p>SPA 页面善用 keep-alive 缓存组件</p></li> <li><p>key 保证唯一</p></li> <li><p>图片资源懒加载</p></li> <li><p>第三方插件的按需引入</p></li> <li><p>防抖、节流</p></li> <li><p>created 开启异步任务处理，提前请求加载数据</p></li></ul> <h4 id="webpack-层面的优化"><a href="#webpack-层面的优化" class="header-anchor">#</a> Webpack 层面的优化</h4> <h2 id="_022-vue-set-的实现原理"><a href="#_022-vue-set-的实现原理" class="header-anchor">#</a> 022： Vue.set 的实现原理</h2> <p>受现代 JavaScript 的限制 ，Vue 无法检测到对象属性的添加或删除，也无法检测数组长度或者通过索引改变数组元素。</p> <p>由于 Vue 会在初始化实例时对属性执行 getter/setter 转化，所以属性必须在 data 对象上存在才能让 Vue 将它转换为响应式的</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">target</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span>any<span class="token operator">&gt;</span> <span class="token operator">|</span> Object<span class="token punctuation">,</span> <span class="token literal-property property">key</span><span class="token operator">:</span> any<span class="token punctuation">,</span> <span class="token literal-property property">val</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span><span class="token operator">:</span> any <span class="token punctuation">{</span>
    <span class="token comment">// target 为数组</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isValidArrayIndex</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 修改数组的长度, 避免索引&gt;数组长度导致splcie()执行有误</span>
        target<span class="token punctuation">.</span>length <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span>length<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 利用数组的splice变异方法触发响应式(数组方法已被重新，因此会自动触发)</span>
        target<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> val<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// key 已经存在，直接修改属性值</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token keyword">in</span> target <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token punctuation">(</span>key <span class="token keyword">in</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> val<span class="token punctuation">;</span>
        <span class="token keyword">return</span> val<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 因为响应式数据 我们给对象和数组本身都增加了__ob__属性，代表的是 Observer 实例。</span>
    <span class="token keyword">const</span> ob <span class="token operator">=</span> <span class="token punctuation">(</span>target<span class="token operator">:</span> any<span class="token punctuation">)</span><span class="token punctuation">.</span>__ob__<span class="token punctuation">;</span>

    <span class="token comment">// target 本身就不是响应式数据, 直接赋值</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ob<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> val<span class="token punctuation">;</span>
        <span class="token keyword">return</span> val<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 对属性进行响应式处理</span>
    <span class="token comment">// 将属性定义成响应式的</span>
    <span class="token function">defineReactive</span><span class="token punctuation">(</span>ob<span class="token punctuation">.</span>value<span class="token punctuation">,</span> key<span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>
    ob<span class="token punctuation">.</span>dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> val<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>由代码可知，Vue.set 的实现原理：</p> <p>（1）如果目标是数组，直接使用数组的 splice 方法触发相应式；</p> <p>（2）如果目标是对象，会先判读属性是否存在、对象是否是响应式，最终如果要对属性进行响应式处理，则是通过调用 defineReactive 方法进行响应式处理（ defineReactive 方法就是 Vue 在初始化对象时，给对象属性采用 Object.defineProperty 动态添加 getter 和 setter 的功能所调用的方法）</p> <h2 id="_023-vue-数据渲染过程"><a href="#_023-vue-数据渲染过程" class="header-anchor">#</a> 023：Vue 数据渲染过程</h2> <p><code>$mount</code> 是渲染的起点。在渲染过程中，提供了三种渲染模式，自定义 Render 函数、template、el 均可以渲染页面。</p> <p>除了 Render 函数模式，其他两种都需要解析成 AST，再将 AST 转化为 Render 函数。</p> <p>Render 函数的作用是什么呢？在/src/core/instance/lifecycle.js 中有这么一段代码：</p> <div class="language-js extra-class"><pre class="language-js"><code>vm<span class="token punctuation">.</span>_watcher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Watcher</span><span class="token punctuation">(</span>
    vm<span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        vm<span class="token punctuation">.</span><span class="token function">_update</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span><span class="token function">_render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> hydrating<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    noop
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>通过 Watcher 的绑定，每当数据发生变化时，执行<code>_update</code>的方法，此时会先执行<code>vm._render()</code>。在这个 <code>vm._render()</code>中，我们的 Render 函数会执行，而得到 VNode 对象。</p> <p>Render 函数执行生成了 VNode，而 VNode 只是 Virtual DOM。</p> <p>过 DOM Diff 之后，来生成真正的 DOM 节点。在/src/core/vdom/patch.js 中的 patch(oldVnode, vnode ,hydrating)方法来完成的。</p> <p>patch 其中的主要逻辑为：<br>
1）当 VNode 为真实元素或旧的 VNode 和新的 VNode 完全相同时，直接调用 createElm 方法生成真实的 DOM 树。<br>
2）当 VNode 新旧存在差异时，则调用 patchVnode 方法，比较新旧 VNode 节点，根据不同的状态对 DOM 做合理的添加、删除、修改 DOM，最后调用 createElm 生成真实的 DOM 树。（更进一步了解可看 diff 算法过程）</p> <p>因此过程大概总结如下：</p> <ol><li>new Vue，执行初始化， 调用 <code>Vue.prototype._init(option)、initMixin、stateMixin、eventsMixin、lifecycleMixin、renderMixin</code></li></ol> <ol start="2"><li>挂载 <code>$mount</code> 方法，通过自定义 Render 方法、template、el 等生成 Render 函数</li> <li>通过 Observe 监听数据的变化，然后通过<code>dep.notify</code>通知对应的 watchers，触发<code>vm._update(vm._render(), hydrating);</code></li> <li>Render 函数执行生成 VNode 对象</li> <li>通过 patch 方法，对比新旧 VNode 对象，通过 DOM Diff 算法，添加、修改、删除真正的 DOM 元素</li></ol> <h2 id="_024-组件更新的过程"><a href="#_024-组件更新的过程" class="header-anchor">#</a> 024：组件更新的过程</h2> <h2 id="_025-为什么-v-for-和-v-if-不能能同时使用"><a href="#_025-为什么-v-for-和-v-if-不能能同时使用" class="header-anchor">#</a> 025：为什么 v-for 和 v-if 不能能同时使用</h2> <p>把 v-if 和 v-for 同时用在同一个元素上。当 Vue 解析指令时，v-for 比 v-if 具有更高的优先级，所以 vue 会先循环所有数据在进行判断,影响性能。</p> <h2 id="_026-为什么组件的-data-是一个函数"><a href="#_026-为什么组件的-data-是一个函数" class="header-anchor">#</a> 026：为什么组件的 data 是一个函数</h2> <h2 id="_027-什么是作用域插槽"><a href="#_027-什么是作用域插槽" class="header-anchor">#</a> 027：什么是作用域插槽</h2> <h2 id="_028-简述-vuex-工作原理"><a href="#_028-简述-vuex-工作原理" class="header-anchor">#</a> 028：简述 vuex 工作原理</h2> <h2 id="_029-action-和-mutation-区别"><a href="#_029-action-和-mutation-区别" class="header-anchor">#</a> 029：action 和 mutation 区别</h2> <h2 id="_030-vue-router-导航守卫类型"><a href="#_030-vue-router-导航守卫类型" class="header-anchor">#</a> 030：vue-router 导航守卫类型</h2> <ol><li>全局前置守卫：router.beforeEach</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>当一个导航触发时，全局前置守卫按照创建顺序调用。守卫是异步解析执行，此时导航在所有守卫 resolve 完之前一直处于等待中。一定要调用<code>next()</code>方法来 resolve 这个钩子。执行效果依赖 next 方法的调用参数。</p> <ol start="2"><li>全局解析守卫： router.beforeResolve</li></ol> <p>和 router.beforeEach 类似，区别是在导航被确认之前，同时在所有组件内守卫和异步路由组件被解析之后，解析守卫就被调用。</p> <ol start="3"><li><p>全局后置钩子： router.afterEach</p></li> <li><p>路由独享的守卫： beforeEnter</p></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 你可以在路由配置上直接定义 beforeEnter 守卫，作用类似用beforeEnter</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">routes</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&quot;/foo&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">component</span><span class="token operator">:</span> Foo<span class="token punctuation">,</span>
            <span class="token function-variable function">beforeEnter</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token comment">// ...</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="5"><li>组件内的守卫： beforeRouteEnter、beforeRouteUpdate (2.2 新增)、beforeRouteLeave</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> Foo <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">...</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token function">beforeRouteEnter</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 在渲染该组件的对应路由被 confirm 前调用</span>
        <span class="token comment">// 不能获取组件实例 `this`</span>
        <span class="token comment">// 因为当守卫执行前，组件实例还没被创建</span>

        <span class="token comment">//不过，可以通过传一个回调给 next来访问组件实例。</span>
        <span class="token comment">//在导航被确认的时候执行回调，并且把组件实例作为回调方法的参数。</span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">vm</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// 通过 `vm` 访问组件实例</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token function">beforeRouteUpdate</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 在当前路由改变，但是该组件被复用时调用</span>
        <span class="token comment">// 举例来说，对于一个带有动态参数的路径 /foo/:id，在 /foo/1 和 /foo/2 之间跳转的时候，</span>
        <span class="token comment">// 由于会渲染同样的 Foo 组件，因此组件实例会被复用。而这个钩子就会在这个情况下被调用。</span>
        <span class="token comment">// 可以访问组件实例 `this`</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token comment">// 通常用来禁止用户在还未保存修改前突然离开。该导航可以通过 next(false) 来取消</span>
    <span class="token function">beforeRouteLeave</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 导航离开该组件的对应路由时调用</span>
        <span class="token comment">// 可以访问组件实例 `this`</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_031-完整的导航解析流程"><a href="#_031-完整的导航解析流程" class="header-anchor">#</a> 031：完整的导航解析流程</h2> <ol><li><p>导航被触发。</p></li> <li><p>在失活的组件里调用 beforeRouteLeave 守卫。</p></li> <li><p>调用全局的 beforeEach 守卫。</p></li> <li><p>在重用的组件里调用 beforeRouteUpdate 守卫 (2.2+)。</p></li> <li><p>在路由配置里调用 beforeEnter。</p></li> <li><p>解析异步路由组件。</p></li> <li><p>在被激活的组件里调用 beforeRouteEnter。</p></li> <li><p>用全局的 beforeResolve 守卫 (2.5+)。</p></li> <li><p>导航被确认。</p></li> <li><p>调用全局的 afterEach 钩子。</p></li> <li><p>触发 DOM 更新（从 beforeCreate -&gt; created -&gt; beforeMount -&gt; mounted [-&gt; activated]）。</p></li> <li><p>调用 beforeRouteEnter 守卫中传给 next 的回调函数，创建好的组件实例会作为回调函数的参数传入。</p></li></ol> <h2 id="_032-简单聊聊-new-vue-以后发生的事情"><a href="#_032-简单聊聊-new-vue-以后发生的事情" class="header-anchor">#</a> 032：简单聊聊 new Vue 以后发生的事情</h2> <p>在 vue 的生命周期上第一个就是 new Vue() 创建一个 vue 实例出来，对应到源码在\vue-dev\src\core\instance\index.js:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Vue</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">&quot;production&quot;</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token keyword">instanceof</span> <span class="token class-name">Vue</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">warn</span><span class="token punctuation">(</span>
            <span class="token string">&quot;Vue is a constructor and should be called with the `new` keyword&quot;</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_init</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">initMixin</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">stateMixin</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">eventsMixin</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">lifecycleMixin</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">renderMixin</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// vue 初始化主要就干了几件事情，合并配置，初始化生命周期，初始化事件中心，初始化渲染，初始化data、props、computed、watcher 等等</span>
</code></pre></div><h2 id="_033-模板字符串解析"><a href="#_033-模板字符串解析" class="header-anchor">#</a> 033：模板字符串解析</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> template <span class="token operator">=</span> <span class="token string">&quot;我是{{name}}，年龄{{age}}，性别{{sex}}&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;chieminchan&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
    <span class="token literal-property property">sex</span><span class="token operator">:</span> <span class="token string">&quot;girl&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">template<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> computed <span class="token operator">=</span> template<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\{\{(\w+)\}\}</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">match<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>match<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> computed<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">render</span><span class="token punctuation">(</span>template<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/fragments/" class="prev router-link-active">
        🌻 知识碎片
      </a></span> <span class="next"><a href="/fragments/Network.html">
        🌵 网络
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.448d156c.js" defer></script><script src="/assets/js/2.fefa3fa1.js" defer></script><script src="/assets/js/1.67a15f5a.js" defer></script><script src="/assets/js/78.81fd1ead.js" defer></script>
  </body>
</html>
