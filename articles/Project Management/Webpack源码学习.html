<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ğŸ‘‰ webpack æ„å»ºæµç¨‹ | CHIEMINCHAN&#39;S BLOG</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/images/donut.png">
    <meta name="description" content="Hi, glad you came.">
    
    <link rel="preload" href="/assets/css/0.styles.8f3dca9f.css" as="style"><link rel="preload" href="/assets/js/app.448d156c.js" as="script"><link rel="preload" href="/assets/js/2.fefa3fa1.js" as="script"><link rel="preload" href="/assets/js/1.67a15f5a.js" as="script"><link rel="preload" href="/assets/js/63.3358d1e0.js" as="script"><link rel="prefetch" href="/assets/js/10.5229b01a.js"><link rel="prefetch" href="/assets/js/11.9dccb5a1.js"><link rel="prefetch" href="/assets/js/12.1aa023e7.js"><link rel="prefetch" href="/assets/js/13.da540175.js"><link rel="prefetch" href="/assets/js/14.981e669d.js"><link rel="prefetch" href="/assets/js/15.f28dd0b3.js"><link rel="prefetch" href="/assets/js/16.47e1d84d.js"><link rel="prefetch" href="/assets/js/17.7ff34030.js"><link rel="prefetch" href="/assets/js/18.6dcbdd16.js"><link rel="prefetch" href="/assets/js/19.e568fd00.js"><link rel="prefetch" href="/assets/js/20.182f1f9b.js"><link rel="prefetch" href="/assets/js/21.b834a74a.js"><link rel="prefetch" href="/assets/js/22.a3523cd2.js"><link rel="prefetch" href="/assets/js/23.61d15c5b.js"><link rel="prefetch" href="/assets/js/24.2aadb209.js"><link rel="prefetch" href="/assets/js/25.836695fb.js"><link rel="prefetch" href="/assets/js/26.0ab922cb.js"><link rel="prefetch" href="/assets/js/27.5ac9e339.js"><link rel="prefetch" href="/assets/js/28.d6a5eb15.js"><link rel="prefetch" href="/assets/js/29.3eea682e.js"><link rel="prefetch" href="/assets/js/3.fc739620.js"><link rel="prefetch" href="/assets/js/30.5225944d.js"><link rel="prefetch" href="/assets/js/31.ec02d3da.js"><link rel="prefetch" href="/assets/js/32.bd05dede.js"><link rel="prefetch" href="/assets/js/33.4a293dcf.js"><link rel="prefetch" href="/assets/js/34.4464026b.js"><link rel="prefetch" href="/assets/js/35.4dd4f327.js"><link rel="prefetch" href="/assets/js/36.ca28dda7.js"><link rel="prefetch" href="/assets/js/37.3a17971f.js"><link rel="prefetch" href="/assets/js/38.f86fa51b.js"><link rel="prefetch" href="/assets/js/39.6ff149b0.js"><link rel="prefetch" href="/assets/js/4.0471e9ae.js"><link rel="prefetch" href="/assets/js/40.23565895.js"><link rel="prefetch" href="/assets/js/41.0116a1ec.js"><link rel="prefetch" href="/assets/js/42.c38f3e0c.js"><link rel="prefetch" href="/assets/js/43.1d0d8ffd.js"><link rel="prefetch" href="/assets/js/44.631fa43e.js"><link rel="prefetch" href="/assets/js/45.0f88df1f.js"><link rel="prefetch" href="/assets/js/46.cc671ab0.js"><link rel="prefetch" href="/assets/js/47.90cce12d.js"><link rel="prefetch" href="/assets/js/48.ad0ce6a4.js"><link rel="prefetch" href="/assets/js/49.ade35f37.js"><link rel="prefetch" href="/assets/js/5.5356be46.js"><link rel="prefetch" href="/assets/js/50.de00c31b.js"><link rel="prefetch" href="/assets/js/51.9de8257a.js"><link rel="prefetch" href="/assets/js/52.50f1abf2.js"><link rel="prefetch" href="/assets/js/53.b3b3acb2.js"><link rel="prefetch" href="/assets/js/54.71bfe1b2.js"><link rel="prefetch" href="/assets/js/55.b00cfb1c.js"><link rel="prefetch" href="/assets/js/56.1bb058d3.js"><link rel="prefetch" href="/assets/js/57.5651fd65.js"><link rel="prefetch" href="/assets/js/58.3dd11306.js"><link rel="prefetch" href="/assets/js/59.233d45e8.js"><link rel="prefetch" href="/assets/js/6.5b3d5499.js"><link rel="prefetch" href="/assets/js/60.7c729149.js"><link rel="prefetch" href="/assets/js/61.eb5805f6.js"><link rel="prefetch" href="/assets/js/62.fde12179.js"><link rel="prefetch" href="/assets/js/64.1b930210.js"><link rel="prefetch" href="/assets/js/65.3048ba53.js"><link rel="prefetch" href="/assets/js/66.a065502e.js"><link rel="prefetch" href="/assets/js/67.715eef17.js"><link rel="prefetch" href="/assets/js/68.edf44196.js"><link rel="prefetch" href="/assets/js/69.94cb6d60.js"><link rel="prefetch" href="/assets/js/7.c94df317.js"><link rel="prefetch" href="/assets/js/70.9061bb98.js"><link rel="prefetch" href="/assets/js/71.980c8e32.js"><link rel="prefetch" href="/assets/js/72.43be58ba.js"><link rel="prefetch" href="/assets/js/73.e2f40377.js"><link rel="prefetch" href="/assets/js/74.9ef8a48c.js"><link rel="prefetch" href="/assets/js/75.b006fb40.js"><link rel="prefetch" href="/assets/js/76.311cf38f.js"><link rel="prefetch" href="/assets/js/77.2d4b2c6d.js"><link rel="prefetch" href="/assets/js/78.81fd1ead.js"><link rel="prefetch" href="/assets/js/79.01e24fba.js"><link rel="prefetch" href="/assets/js/80.b15cc1f3.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.934ed2fb.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8f3dca9f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">CHIEMINCHAN'S BLOG</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  é¦–é¡µ
</a></div><div class="nav-item"><a href="/articles/" class="nav-link router-link-active">
  æ–‡ç« 
</a></div><div class="nav-item"><a href="/fragments/" class="nav-link">
  çŸ¥è¯†ç¢ç‰‡
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  ç®—æ³•
</a></div><div class="nav-item"><a href="/reading/" class="nav-link">
  è¯»/è§‚åæ„Ÿ
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GitHub" class="dropdown-title"><span class="title">GitHub</span> <span class="arrow down"></span></button> <button type="button" aria-label="GitHub" class="mobile-dropdown-title"><span class="title">GitHub</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/chieminchan" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHubé¦–é¡µ
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  é¦–é¡µ
</a></div><div class="nav-item"><a href="/articles/" class="nav-link router-link-active">
  æ–‡ç« 
</a></div><div class="nav-item"><a href="/fragments/" class="nav-link">
  çŸ¥è¯†ç¢ç‰‡
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  ç®—æ³•
</a></div><div class="nav-item"><a href="/reading/" class="nav-link">
  è¯»/è§‚åæ„Ÿ
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GitHub" class="dropdown-title"><span class="title">GitHub</span> <span class="arrow down"></span></button> <button type="button" aria-label="GitHub" class="mobile-dropdown-title"><span class="title">GitHub</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/chieminchan" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHubé¦–é¡µ
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Browser</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>DesignPatterns</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Microapp</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Network</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Project Management</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/articles/Project Management/Webapckçƒ­æ›¿æ¢.html" class="sidebar-link">ğŸ‘‰ Webpack çƒ­æ›¿æ¢</a></li><li><a href="/articles/Project Management/Webpack åŸºç¡€æ‰«ç›².html" class="sidebar-link">ğŸ‘‰ Webpack åŸºç¡€æ‰«ç›²</a></li><li><a href="/articles/Project Management/Webpackæºç å­¦ä¹ .html" class="active sidebar-link">ğŸ‘‰ webpack æ„å»ºæµç¨‹</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/articles/Project Management/Webpackæºç å­¦ä¹ .html#webpack-åšäº†ä»€ä¹ˆ" class="sidebar-link">webpack åšäº†ä»€ä¹ˆ</a></li><li class="sidebar-sub-header"><a href="/articles/Project Management/Webpackæºç å­¦ä¹ .html#webpack-çš„æ„å»ºæµç¨‹" class="sidebar-link">webpack çš„æ„å»ºæµç¨‹</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/articles/Project Management/Webpackæºç å­¦ä¹ .html#åˆå§‹åŒ–é˜¶æ®µ-compile" class="sidebar-link">åˆå§‹åŒ–é˜¶æ®µï¼ˆcompileï¼‰</a></li><li class="sidebar-sub-header"><a href="/articles/Project Management/Webpackæºç å­¦ä¹ .html#æ„å»ºé˜¶æ®µ-make" class="sidebar-link">æ„å»ºé˜¶æ®µï¼ˆmakeï¼‰</a></li><li class="sidebar-sub-header"><a href="/articles/Project Management/Webpackæºç å­¦ä¹ .html#ç”Ÿæˆé˜¶æ®µ-seal" class="sidebar-link">ç”Ÿæˆé˜¶æ®µï¼ˆsealï¼‰</a></li><li class="sidebar-sub-header"><a href="/articles/Project Management/Webpackæºç å­¦ä¹ .html#å†™å…¥é˜¶æ®µ-emit" class="sidebar-link">å†™å…¥é˜¶æ®µï¼ˆemitï¼‰</a></li></ul></li></ul></li><li><a href="/articles/Project Management/Webæ€§èƒ½ä¼˜åŒ–.html" class="sidebar-link">ğŸ‘‰ Web æ€§èƒ½ä¼˜åŒ–</a></li><li><a href="/articles/Project Management/npm åŒ…ç®¡ç†.html" class="sidebar-link">ğŸ‘‰ npm åŒ…ç®¡ç†</a></li><li><a href="/articles/Project Management/rollup å…¥é—¨ç¯‡.html" class="sidebar-link">ğŸ‘‰ rollup å…¥é—¨ç¯‡</a></li><li><a href="/articles/Project Management/æ‰‹æŠŠæ‰‹æ•™ä½ å‘ä¸ªnpmåŒ….html" class="sidebar-link">ğŸ‘‰ æ‰‹æŠŠæ‰‹æ•™ä½ å‘ä¸ª npm åŒ…</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>TypeScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="webpack-æ„å»ºæµç¨‹"><a href="#webpack-æ„å»ºæµç¨‹" class="header-anchor">#</a> ğŸ‘‰ webpack æ„å»ºæµç¨‹</h1> <p>å‚è€ƒæ–‡ç« ï¼š</p> <ul><li><a href="https://mp.weixin.qq.com/s/ZJBwPp64TKMl230SKxHluA" target="_blank" rel="noopener noreferrer">90 è¡Œä»£ç çš„ webpackï¼Œä½ ç¡®å®šä¸å­¦å—ï¼Ÿ<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://mp.weixin.qq.com/s?__biz=MzI0MTUxOTE5NQ==&amp;mid=2247484030&amp;idx=1&amp;sn=d630d4b3995bbfd50f99e781074acfeb" target="_blank" rel="noopener noreferrer">ä¸€æ–‡æŒæ¡ Webpack ç¼–è¯‘æµç¨‹ <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://blog.csdn.net/frontend_frank/article/details/106205260" target="_blank" rel="noopener noreferrer">æ­ç§˜ webpack æ’ä»¶å·¥ä½œæµç¨‹å’ŒåŸç†<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://juejin.cn/post/6844903895584473096" target="_blank" rel="noopener noreferrer">Webpack æºç è§£è¯»ï¼šç†æ¸…ç¼–è¯‘ä¸»æµç¨‹ <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://zhuanlan.zhihu.com/p/73325163" target="_blank" rel="noopener noreferrer">webpack æ˜¯å¦‚ä½•å®ç°åŠ¨æ€å¯¼å…¥çš„<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://juejin.cn/post/6844904180285456398" target="_blank" rel="noopener noreferrer">ã€Webpack ç³»åˆ—ã€â€”â€” è·¯ç”±æ‡’åŠ è½½çš„åŸç† <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>è¿˜æœ‰ï¼Œtecvan å¤§ä½¬æ€»ç»“çš„éå¸¸æœ‰æ·±åº¦çš„ webpack ç³»åˆ—ï¼š</p> <ul><li><a href="https://juejin.cn/post/6949040393165996040" target="_blank" rel="noopener noreferrer">[ä¸‡å­—æ€»ç»“] ä¸€æ–‡åƒé€ Webpack æ ¸å¿ƒåŸç† <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://juejin.cn/post/6958811421224206343" target="_blank" rel="noopener noreferrer">æœ‰ç‚¹éš¾çš„ webpack çŸ¥è¯†ç‚¹ï¼šDependency Graph æ·±åº¦è§£æ<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="webpack-åšäº†ä»€ä¹ˆ"><a href="#webpack-åšäº†ä»€ä¹ˆ" class="header-anchor">#</a> webpack åšäº†ä»€ä¹ˆ</h2> <p>æˆ‘ä»¬å¯ä»¥ä»æ„å»ºæ–‡ä»¶ä½œä¸ºå¼€å§‹ï¼Œè¿›è¡Œåˆ†æã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// index.js</span>
<span class="token keyword">const</span> one <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./one.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">one</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// one.js</span>
<span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&quot;./two.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> two <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;import two&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">two</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;one&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// two.js</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;two&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// webpack.config.js</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;html-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> CleanWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;clean-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&quot;development&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">main</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;../src/index.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;js/[chunkhash].js&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;../dist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;webpack-case&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">template</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;../public/index.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>æœ€åæ‰§è¡Œ<code>webpack --config webpack.config.js</code>åï¼Œåœ¨<code>dist/js</code>æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºäº†ä¸€ä¸ª<code>35f63560f4987ba7b874.jsï¼ˆå¯¹åº”ä¸»å…¥å£ï¼‰å’Œ35f63560f4987ba7b874.jsï¼ˆä¸€ä¸ªå¯¹åº”åŠ¨æ€å¼•å…¥çš„two.jsï¼‰</code></p> <p>åœ¨åˆ é™¤äº†ä¸€äº›æ³¨è§†ç¬¦å·å’Œå¢åŠ äº†ä¸€äº›å¸®åŠ©è‡ªå·±ç†è§£çš„æ³¨é‡Šåï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// e74980cea533ebbd6176.js</span>

<span class="token comment">// self[&quot;webpackChunkwebpack_cases&quot;]æ•°ç»„ä¼špushè¿›ä¸€ä¸ªæ•°ç»„ï¼Œè€Œè¿™ä¸ªæ•°ç»„æ˜¯two.jsçš„ä¿¡æ¯ï¼Œå…¶ä¸­ç¬¬äºŒé¡¹æ˜¯æ­£æ˜¯è¡¨ç¤ºæºç çš„ä¸€ä¸ªå¯¹è±¡</span>
<span class="token punctuation">(</span>self<span class="token punctuation">[</span><span class="token string">&quot;webpackChunkwebpack_cases&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span>
    self<span class="token punctuation">[</span><span class="token string">&quot;webpackChunkwebpack_cases&quot;</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token string">&quot;src_two_js&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;./src/two.js&quot;</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">module</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">eval</span><span class="token punctuation">(</span>
                <span class="token string">&quot;// two.js\nmodule.exports = function () {\n  console.log('two')\n}\n\n//# sourceURL=webpack://webpack-cases/./src/two.js?&quot;</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 35f63560f4987ba7b874.js</span>

<span class="token comment">// åˆ›å»ºä¸€ä¸ªè‡ªæ‰§è¡Œå‡½æ•°</span>
<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// webpackBootstrap</span>

    <span class="token comment">// index.jså’Œone.js è¢«ä»¥é”®å€¼å¯¹çš„å½¢å¼ä¿å­˜åˆ°äº† __webpack_modules__ ä¸Š</span>
    <span class="token comment">// å¯¹è±¡çš„ key ä¸ºæ¨¡å—è·¯å¾„åï¼Œvalue ä¸ºä¸€ä¸ªè¢«åŒ…è£…è¿‡çš„æ¨¡å—å‡½æ•°ã€‚</span>
    <span class="token comment">// å‡½æ•°æ‹¥æœ‰ module, module.exports, __webpack_require__ ä¸‰ä¸ªå‚æ•°ã€‚</span>
    <span class="token comment">// è¿™ä½¿å¾—æ¯ä¸ªæ¨¡å—éƒ½æ‹¥æœ‰ä½¿ç”¨ module.exports å¯¼å‡ºæœ¬æ¨¡å—å’Œä½¿ç”¨ __webpack_require__ å¼•å…¥å…¶ä»–æ¨¡å—çš„èƒ½åŠ›ï¼ŒåŒæ—¶ä¿è¯äº†æ¯ä¸ªæ¨¡å—éƒ½å¤„äºä¸€ä¸ªéš”ç¦»çš„å‡½æ•°ä½œç”¨åŸŸèŒƒå›´ã€‚</span>
    <span class="token keyword">var</span> __webpack_modules__ <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;./src/index.js&quot;</span><span class="token operator">:</span> <span class="token punctuation">(</span>
            <span class="token parameter">__unused_webpack_module<span class="token punctuation">,</span>
            __unused_webpack_exports<span class="token punctuation">,</span>
            __webpack_require__</span>
        <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">eval</span><span class="token punctuation">(</span>
                <span class="token string">&quot;const one = __webpack_require__(/*! ./one.js */ \&quot;./src/one.js\&quot;);\none();\n\n// class Animal {\n//   constructor(name) {\n//       this.name = name;\n//   }\n//   getName() {\n//       return this.name;\n//   }\n// }\n\n// const dog = new Animal('dog');\n\n//# sourceURL=webpack://webpack-cases/./src/index.js?&quot;</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>

        <span class="token string-property property">&quot;./src/one.js&quot;</span><span class="token operator">:</span> <span class="token punctuation">(</span>
            <span class="token parameter">module<span class="token punctuation">,</span>
            __unused_webpack_exports<span class="token punctuation">,</span>
            __webpack_require__</span>
        <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// å¯¹äºå¼‚æ­¥å¼•å…¥ä¼šè¢«è½¬æ¢æˆ __webpack_require__.e</span>
            <span class="token comment">// __webpack_require__.eæ–¹æ³•æ˜¯å®ç°æ‡’åŠ è½½çš„æ ¸å¿ƒ</span>
            <span class="token function">eval</span><span class="token punctuation">(</span>
                <span class="token string">&quot;__webpack_require__.e(/*! import() */ \&quot;src_two_js\&quot;).then(__webpack_require__.t.bind(__webpack_require__, /*! ./two.js */ \&quot;./src/two.js\&quot;, 23)).then(({two}) =&gt; {\n  console.log('import two');\n  two();\n})\n\nmodule.exports = function () {\n  console.log('one')\n}\n\n//# sourceURL=webpack://webpack-cases/./src/one.js?&quot;</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// The module cache</span>
    <span class="token comment">// ä½¿ç”¨ __webpack_require__ å‡½æ•°åŠ è½½å®Œæˆçš„æ¨¡å—ä¼šè¢«ç¼“å­˜åˆ° __webpack_module_cache__ å¯¹è±¡ä¸Šï¼Œä»¥ä¾¿ä¸‹æ¬¡å¦‚æœæœ‰å…¶ä»–æ¨¡å—ä¾èµ–æ­¤æ¨¡å—æ—¶ï¼Œä¸éœ€è¦é‡æ–°è¿è¡Œæ¨¡å—çš„åŒ…è£…å‡½æ•°ï¼Œå‡å°‘æ‰§è¡Œæ•ˆç‡çš„æ¶ˆè€—ã€‚åŒæ—¶ï¼Œä¹Ÿé¿å…äº†å¾ªç¯ä¾èµ–æ— é™é€’å½’çš„å‡ºç°ã€‚</span>
    <span class="token keyword">var</span> __webpack_module_cache__ <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// å®šä¹‰requireå‡½æ•°</span>
    <span class="token comment">// requireæ˜¯nodeç¯å¢ƒè‡ªå¸¦çš„ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œè€Œåœ¨å…¶ä»–ç¯å¢ƒåˆ™æ²¡æœ‰è¿™æ ·ä¸€ä¸ªå˜é‡ï¼Œäºæ˜¯éœ€è¦webpackæä¾›è¿™æ ·ç›¸ä¼¼çš„èƒ½åŠ›ï¼Œ</span>
    <span class="token keyword">function</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token parameter">moduleId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// æ£€æŸ¥æ˜¯å¦å·²ç»æ„å»ºè¿‡</span>
        <span class="token comment">// Check if module is in cache</span>
        <span class="token keyword">var</span> cachedModule <span class="token operator">=</span> __webpack_module_cache__<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>cachedModule <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> cachedModule<span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// æ–°æ„å»ºï¼Œåˆ™ä¸ºå®ƒåˆ›å»ºä¸€ä¸ªä¸“å±çš„moduleIdå¹¶ç¼“å­˜èµ·æ¥</span>
        <span class="token comment">// Create a new module (and put it into the cache)</span>
        <span class="token keyword">var</span> module <span class="token operator">=</span> <span class="token punctuation">(</span>__webpack_module_cache__<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token comment">// no module.id needed</span>
            <span class="token comment">// no module.loaded needed</span>
            <span class="token literal-property property">exports</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// æ‰§è¡Œæ¨¡å—é‡Œçš„å‡½æ•°ä»£ç </span>
        <span class="token comment">// Execute the module function</span>
        __webpack_modules__<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">(</span>
            module<span class="token punctuation">,</span>
            module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span>
            __webpack_require__
        <span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Return the exports of the module</span>
        <span class="token keyword">return</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// æš´éœ²modules expose the modules object (__webpack_modules__)</span>
    __webpack_require__<span class="token punctuation">.</span>m <span class="token operator">=</span> __webpack_modules__<span class="token punctuation">;</span>

    <span class="token comment">// ...</span>

    <span class="token comment">/* webpack/runtime/ensure chunk */</span>
    <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        __webpack_require__<span class="token punctuation">.</span>f <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token comment">// This file contains only the entry chunk.</span>
        <span class="token comment">// The chunk loading function for additional chunks</span>
        __webpack_require__<span class="token punctuation">.</span><span class="token function-variable function">e</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">chunkId</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>
                Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>__webpack_require__<span class="token punctuation">.</span>f<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">promises<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    __webpack_require__<span class="token punctuation">.</span>f<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">(</span>chunkId<span class="token punctuation">,</span> promises<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> promises<span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* webpack/runtime/jsonp chunk loading */</span>
    <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// object to store loaded and loading chunks</span>
        <span class="token comment">// undefined = chunk not loaded, null = chunk preloaded/prefetched</span>
        <span class="token comment">// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded</span>
        <span class="token keyword">var</span> installedChunks <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">main</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token comment">//...</span>

        <span class="token comment">// install a JSONP callback for chunk loading</span>
        <span class="token comment">// æ‰§è¡Œ installedChunks ä¸­çš„ resolve ï¼Œ è®© import() å¾—ä»¥ç»§ç»­æ‰§è¡Œã€‚</span>
        <span class="token comment">// å°† chunk ä¸­å«æœ‰çš„æ¨¡å—å…¨éƒ¨æ³¨å†Œåˆ°__webpack_require__.må˜é‡ä¸­ã€‚</span>
        <span class="token keyword">var</span> <span class="token function-variable function">webpackJsonpCallback</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">parentChunkLoadingFunction<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> <span class="token punctuation">[</span>chunkIds<span class="token punctuation">,</span> moreModules<span class="token punctuation">,</span> runtime<span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">;</span>

            <span class="token comment">// add &quot;moreModules&quot; to the modules object,</span>
            <span class="token comment">// then flag all &quot;chunkIds&quot; as loaded and fire callback</span>
            <span class="token keyword">var</span> moduleId<span class="token punctuation">,</span>
                chunkId<span class="token punctuation">,</span>
                i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span>moduleId <span class="token keyword">in</span> moreModules<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>__webpack_require__<span class="token punctuation">.</span><span class="token function">o</span><span class="token punctuation">(</span>moreModules<span class="token punctuation">,</span> moduleId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    __webpack_require__<span class="token punctuation">.</span>m<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span> <span class="token operator">=</span> moreModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>runtime<span class="token punctuation">)</span> <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token function">runtime</span><span class="token punctuation">(</span>__webpack_require__<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// è¿™å¥ä»£ç åœ¨å¤šå…¥å£é¡¹ç›®ä¸­æ‰æœ‰ä½œç”¨ï¼Œ</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>parentChunkLoadingFunction<span class="token punctuation">)</span> <span class="token function">parentChunkLoadingFunction</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> chunkIds<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                chunkId <span class="token operator">=</span> chunkIds<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>
                    __webpack_require__<span class="token punctuation">.</span><span class="token function">o</span><span class="token punctuation">(</span>installedChunks<span class="token punctuation">,</span> chunkId<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
                    installedChunks<span class="token punctuation">[</span>chunkId<span class="token punctuation">]</span>
                <span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    installedChunks<span class="token punctuation">[</span>chunkId<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                installedChunks<span class="token punctuation">[</span>chunkIds<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token comment">// å…ˆæŠŠself[&quot;webpackChunkwebpack_cases&quot;]èµ‹å€¼ç»™chunkLoadingGlobal</span>
        <span class="token keyword">var</span> chunkLoadingGlobal <span class="token operator">=</span> <span class="token punctuation">(</span>self<span class="token punctuation">[</span><span class="token string">&quot;webpackChunkwebpack_cases&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span>
            self<span class="token punctuation">[</span><span class="token string">&quot;webpackChunkwebpack_cases&quot;</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        chunkLoadingGlobal<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token function">webpackJsonpCallback</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// ç”¨webpackJsonpCallbackå‡½æ•°æ‹¦æˆªchunkLoadingGlobalçš„pushæ–¹æ³•</span>
        <span class="token comment">// ä¹Ÿå°±æ˜¯è¯´è°ƒç”¨self[&quot;webpackChunkwebpack_cases&quot;]çš„pushæ–¹æ³•éƒ½ä¼šæ‰§è¡ŒwebpackJsonpCallbackå‡½æ•°ã€‚</span>
        chunkLoadingGlobal<span class="token punctuation">.</span>push <span class="token operator">=</span> <span class="token function">webpackJsonpCallback</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>
            <span class="token keyword">null</span><span class="token punctuation">,</span>
            chunkLoadingGlobal<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>chunkLoadingGlobal<span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ...</span>

    <span class="token comment">// ä»å…¥å£å¼€å§‹ï¼Œé€’å½’è¯»å–ä¾èµ–æ¨¡å—</span>
    <span class="token comment">// startup</span>
    <span class="token comment">// Load entry module and return exports</span>
    <span class="token comment">// This entry module can't be inlined because the eval devtool is used.</span>
    <span class="token keyword">var</span> __webpack_exports__ <span class="token operator">=</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>ä»ä»¥ä¸Šæ¥çœ‹ï¼Œwebpack ä¸»è¦åšçš„äº‹æƒ…æœ‰ï¼š</p> <ol><li>è¯»å–å…¥å£æ–‡ä»¶ï¼Œå¹¶æ”¶é›†ä¾èµ–ä¿¡æ¯</li> <li>é€’å½’åœ°è¯»å–æ‰€æœ‰ä¾èµ–æ¨¡å—ï¼Œäº§å‡ºå®Œæ•´çš„ä¾èµ–åˆ—è¡¨</li> <li>å°†å„æ¨¡å—å†…å®¹æ‰“åŒ…æˆä¸€å—å®Œæ•´çš„å¯è¿è¡Œä»£ç </li></ol> <p>å…¶ä¸­æ¶‰åŠï¼š</p> <ol><li><code>@babel/parser</code>ç”¨äºè§£ææºä»£ç ï¼Œäº§å‡º AST</li> <li><code>@babel/traverse</code> ç”¨äºéå† ASTï¼Œæ‰¾åˆ° require è¯­å¥å¹¶ä¿®æ”¹æˆ <em>require</em>ï¼Œå°†å¼•å…¥è·¯å¾„æ”¹é€ ä¸ºç›¸å¯¹æ ¹çš„è·¯å¾„</li> <li><code>@babel/core</code> ç”¨äºå°†ä¿®æ”¹åçš„ AST è½¬æ¢æˆæ–°çš„ä»£ç è¾“å‡º</li></ol> <p>é’ˆå¯¹åŠ¨æ€å¼•å…¥çš„æ¨¡å—ï¼Œ ä¼šå¦å¤–æ‰“åŒ…å‡ºä¸€ä¸ª chunkï¼Œå¹¶ä¸”åœ¨æºä»£ç ä¸­é€šè¿‡<code>__webpack_require__.e</code>å¼•å…¥ï¼Œè¿™ä¸ªå‡½æ•°ä¸»è¦åšçš„äº‹æƒ…ï¼š</p> <ol><li>è®¾ç½® chunk åŠ è½½çš„ä¸‰ç§çŠ¶æ€å¹¶ç¼“å­˜åœ¨ installedChunks ä¸­ï¼Œé˜²æ­¢ chunk é‡å¤åŠ è½½ï¼š
<ul><li>installedChunks[chunkId]ä¸º 0ï¼Œä»£è¡¨è¯¥ chunk å·²ç»åŠ è½½å®Œæ¯•ã€‚</li> <li>installedChunks[chunkId]ä¸º undefinedï¼Œä»£è¡¨è¯¥ chunk åŠ è½½å¤±è´¥ã€åŠ è½½è¶…æ—¶ã€ä»æœªåŠ è½½è¿‡ã€‚</li> <li>installedChunks[chunkId]ä¸º Promise å¯¹è±¡ï¼Œä»£è¡¨è¯¥ chunk æ­£åœ¨åŠ è½½ã€‚</li></ul></li> <li>å‡å¦‚æ²¡åŠ è½½è¿‡ï¼Œåˆ™å‘èµ·ä¸€ä¸ª JSONP è¯·æ±‚å»åŠ è½½ chunk</li> <li>å¤„ç† chunk åŠ è½½è¶…æ—¶å’ŒåŠ è½½å‡ºé”™çš„åœºæ™¯ã€‚</li></ol> <h2 id="webpack-çš„æ„å»ºæµç¨‹"><a href="#webpack-çš„æ„å»ºæµç¨‹" class="header-anchor">#</a> webpack çš„æ„å»ºæµç¨‹</h2> <h3 id="åˆå§‹åŒ–é˜¶æ®µ-compile"><a href="#åˆå§‹åŒ–é˜¶æ®µ-compile" class="header-anchor">#</a> åˆå§‹åŒ–é˜¶æ®µï¼ˆcompileï¼‰</h3> <h4 id="step1-åˆå§‹åŒ–å‚æ•°"><a href="#step1-åˆå§‹åŒ–å‚æ•°" class="header-anchor">#</a> Step1ï¼šåˆå§‹åŒ–å‚æ•°</h4> <p>ç»“åˆé»˜è®¤é…ç½®æ–‡ä»¶ã€é…ç½®å¯¹è±¡å’Œ shell å‘½ä»¤å‚æ•°ï¼Œå¾—å‡ºæœ€ç»ˆçš„é…ç½®å‚æ•°ã€‚</p> <h4 id="step2-åˆ›å»ºç¼–è¯‘å™¨å¯¹è±¡-compiler"><a href="#step2-åˆ›å»ºç¼–è¯‘å™¨å¯¹è±¡-compiler" class="header-anchor">#</a> Step2ï¼šåˆ›å»ºç¼–è¯‘å™¨å¯¹è±¡ Compiler</h4> <p>ç”¨é…ç½®å‚æ•°åˆ›å»ºç¼–è¯‘å™¨å¯¹è±¡ï¼ŒCompiler è´Ÿè´£æ–‡ä»¶ç›‘å¬å’Œå¯åŠ¨ç¼–è¯‘ã€‚</p> <p>Compiler å®ä¾‹ä¸­åŒ…å«äº†å®Œæ•´çš„ Webpack é…ç½®ï¼Œå…¨å±€åªæœ‰ä¸€ä¸ª Compiler å®ä¾‹ï¼ŒCompiler å°†è´¯ç©¿æ•´ä¸ª webpack æ„å»ºè¿‡ç¨‹ï¼Œç›´åˆ°è¿è¡Œç»“æŸã€‚</p> <h4 id="step3-åˆå§‹åŒ–ç¼–è¯‘ç¯å¢ƒ"><a href="#step3-åˆå§‹åŒ–ç¼–è¯‘ç¯å¢ƒ" class="header-anchor">#</a> Step3ï¼šåˆå§‹åŒ–ç¼–è¯‘ç¯å¢ƒ</h4> <p>åŒ…æ‹¬æ³¨å…¥å†…ç½®æ’ä»¶ã€æ³¨å†Œå„ç§æ¨¡å—å·¥å‚ã€åˆå§‹åŒ– RuleSet é›†åˆã€åŠ è½½é…ç½®çš„æ’ä»¶ç­‰ã€‚</p> <ul><li><p>æ³¨å…¥å†…ç½®æ’ä»¶ï¼š<br>
webpack å†…ç½®äº†æ•°ç™¾ä¸ªæ’ä»¶ï¼Œè¿™äº›æ’ä»¶å¹¶ä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨é…ç½®ï¼Œè€Œæ˜¯é€šè¿‡ WebpackOptionsApply ç±»ä¼šåœ¨åˆå§‹åŒ–é˜¶æ®µæ ¹æ®é…ç½®å†…å®¹åŠ¨æ€æ³¨å…¥å¯¹åº”çš„æ’ä»¶ã€‚å…¶ä¸­åŒ…æ‹¬ï¼š</p> <ul><li>EntryOptionPlugin æ’ä»¶ï¼Œå¤„ç† entry é…ç½®ï¼›</li> <li>æ ¹æ® devtool å€¼åˆ¤æ–­åç»­ç”¨å“ªä¸ªæ’ä»¶å¤„ç† sourcemapï¼›</li> <li>æ³¨å…¥ RuntimePlugin ï¼Œç”¨äºæ ¹æ®ä»£ç å†…å®¹åŠ¨æ€æ³¨å…¥ webpack è¿è¡Œæ—¶</li> <li>...</li></ul></li> <li><p>åŠ è½½æ’ä»¶:<br>
ä¼šä¾æ¬¡è°ƒç”¨æ’ä»¶çš„ apply æ–¹æ³•ï¼Œè®©æ’ä»¶å¯ä»¥ç›‘å¬åç»­çš„æ‰€æœ‰äº‹ä»¶èŠ‚ç‚¹ã€‚åŒæ—¶ç»™æ’ä»¶ä¼ å…¥ compiler å®ä¾‹çš„å¼•ç”¨ï¼Œä»¥æ–¹ä¾¿æ’ä»¶é€šè¿‡ compiler è°ƒç”¨ Webpack æä¾›çš„ APIã€‚</p></li></ul> <h4 id="step4-å¼€å§‹ç¼–è¯‘-compiler-run"><a href="#step4-å¼€å§‹ç¼–è¯‘-compiler-run" class="header-anchor">#</a> Step4ï¼šå¼€å§‹ç¼–è¯‘ compiler.run</h4> <p>ç›¸åº”çš„ç¯å¢ƒå‚æ•°é¢„è®¾å¥½äº†ï¼Œæ¥ç€æ‰§è¡Œ compiler å¯¹è±¡çš„ run æ–¹æ³•ã€‚</p> <p>å…¶ä¸­ï¼Œrun æ–¹æ³•ä¼šè§¦å‘ compiler.compileï¼Œæ¥ç€è¿›ä¸€æ­¥ã€‚</p> <p>è¿™é‡Œä¼šåˆ›å»º compilationï¼Œcompilation ä»£è¡¨ä¸€æ¬¡å•ä¸€çš„ç‰ˆæœ¬æ„å»ºå’Œç”Ÿæˆèµ„æºã€‚compilation ç¼–è¯‘ä½œä¸šå¯ä»¥å¤šæ¬¡æ‰§è¡Œï¼Œæ¯”å¦‚ webpack å·¥ä½œåœ¨ watch æ¨¡å¼ä¸‹ï¼Œæ¯æ¬¡ç›‘æµ‹åˆ°æºæ–‡ä»¶å‘ç”Ÿå˜åŒ–æ—¶ï¼Œéƒ½ä¼šé‡æ–°å®ä¾‹åŒ–ä¸€ä¸ª compilation å¯¹è±¡ã€‚</p> <p>ä¸€ä¸ª compilation å¯¹è±¡è¡¨ç°äº†å½“å‰çš„æ¨¡å—èµ„æºã€ç¼–è¯‘ç”Ÿæˆèµ„æºå’Œè¢«è·Ÿè¸ªä¾èµ–çš„çŠ¶æ€ä¿¡æ¯ã€‚</p> <h4 id="step5-ç¡®è®¤å…¥å£"><a href="#step5-ç¡®è®¤å…¥å£" class="header-anchor">#</a> Step5ï¼šç¡®è®¤å…¥å£</h4> <p>æ ¹æ®é…ç½®ä¸­çš„ entry æ‰¾å‡ºæ‰€æœ‰çš„å…¥å£æ–‡ä»¶ï¼Œè°ƒç”¨ compilition.addEntry å°†å…¥å£æ–‡ä»¶è½¬æ¢ä¸º dependence å¯¹è±¡ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// å–è‡ª lib/webpack.jsï¼š</span>
<span class="token comment">// https://github.com/webpack/webpack/blob/2151f56ae7/lib/webpack.js#L57</span>

<span class="token comment">// Step0: å¯åŠ¨ webpack ï¼Œè§¦å‘ lib/webpack.js æ–‡ä»¶ä¸­ createCompiler æ–¹æ³•</span>
<span class="token keyword">const</span> <span class="token function-variable function">webpack</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">options<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

    <span class="token keyword">let</span> compiler <span class="token operator">=</span> <span class="token function">createCompiler</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
    <span class="token operator">...</span>
    <span class="token comment">// å¦‚æœä¼ å…¥callbackå‡½æ•°ï¼Œåˆ™è‡ªå¯åŠ¨</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">{</span>

        <span class="token comment">// Step4: æ‰§è¡Œcompiler.run / compiler.watch(watchæ¨¡å¼ä¸‹)</span>
        <span class="token comment">// ç›¸å…³è¯¦ç»†æºç å¯è§ï¼šhttps://github.com/webpack/webpack/blob/ad1c80214d30676edcf83cb8f74135646ced9cc8/lib/webpack.js#L133</span>
        <span class="token comment">// åœ¨runå‡½æ•°ä¸­å‡ºç°çš„é’©å­æœ‰ï¼šbeforeRun --&gt; run --&gt; done --&gt; afterDoneï¼Œç¬¬ä¸‰æ–¹æ’ä»¶å¯ä»¥é’©ä½ä¸åŒçš„ç”Ÿå‘½å‘¨æœŸï¼Œæ¥æ”¶compilerå¯¹è±¡ï¼Œå¤„ç†ä¸åŒé€»è¾‘ã€‚</span>
        compiler<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> states</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

          <span class="token comment">// compiler.runæ–¹æ³•ä¼šè§¦å‘compiler.compileï¼ˆå’ŒStep5æœ‰å…³ï¼Œå¾€ä¸‹çœ‹ï¼‰</span>
           compiler<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err2</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                <span class="token function">callbacl</span><span class="token punctuation">(</span>err <span class="token operator">||</span> err2<span class="token punctuation">,</span> states<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token operator">...</span>
    <span class="token keyword">return</span> compiler
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">createCompiler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">rawOptions</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// webpackå†…éƒ¨ä¼šæœ‰ä¸€ä¸ªé»˜è®¤çš„é…ç½®ï¼Œåœ¨ webpack.jså…¥å£å¤„ç†å‡½æ•°ä¸­ï¼Œåˆå§‹åŒ–äº†æ‰€æœ‰çš„é»˜è®¤é…ç½®ã€‚</span>
    <span class="token comment">// ä¸»è¦æœ‰ä¸‰ç§å¯¹æ¨¡å—çš„é»˜è®¤é…ç½®ï¼Œè¾“å‡ºoutputï¼Œè§£æoptimizationï¼ŒåŠ è½½resolveæ¨¡å—ä»¥åŠresolveLoaderã€‚</span>

    <span class="token comment">// Step1: getNormalizedWebpackOptions å’Œ applyWebpackOptionsBaseDefaults åˆå¹¶å‡ºæœ€ç»ˆé…ç½®ï¼ˆWebpackOptionsDefaulteré‡Œçš„é€»è¾‘ï¼‰</span>
    <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token function">getNormalizedWebpackOptions</span><span class="token punctuation">(</span>rawOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">applyWebpackOptionsBaseDefaults</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Step2: ç”¨é…ç½®å‚æ•°åˆ›å»ºç¼–è¯‘å™¨å¯¹è±¡ï¼ŒCompiler å®ä¾‹ä¸­åŒ…å«äº†å®Œæ•´çš„ Webpack é…ç½®</span>
    <span class="token keyword">const</span> compiler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Compiler</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    compiler<span class="token punctuation">.</span>options <span class="token operator">=</span> options<span class="token punctuation">;</span>

    <span class="token comment">// æ’ä»¶é€šè¿‡applyæ¥å—compilerå‚æ•°</span>
    <span class="token keyword">new</span> <span class="token class-name">NodeEnvironmentPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">infrastructureLogging</span><span class="token operator">:</span> options<span class="token punctuation">.</span>infrastructureLogging<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>plugins<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ä¾æ¬¡è°ƒç”¨æ’ä»¶çš„ apply æ–¹æ³•ï¼Œè®©æ’ä»¶å¯ä»¥ç›‘å¬åç»­çš„æ‰€æœ‰äº‹ä»¶èŠ‚ç‚¹</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> plugin <span class="token keyword">of</span> options<span class="token punctuation">.</span>plugins<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> plugin <span class="token operator">===</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">plugin</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>compiler<span class="token punctuation">,</span> compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token function">plugin</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token function">applyWebpackOptionsDefaults</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>

    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">environment</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">afterEnvironment</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Step3ï¼šåˆå§‹åŒ–ç¼–è¯‘ç¯å¢ƒï¼Œæ ¹æ®é…ç½®å†…å®¹åŠ¨æ€æ³¨å…¥å¯¹åº”çš„æ’ä»¶</span>
    <span class="token keyword">new</span> <span class="token class-name">WebpackOptionsApply</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>

    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> compiler<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// å–è‡ª lib/WebpackOptionsApply.jsï¼š</span>
<span class="token comment">// https://github.com/webpack/webpack/blob/2151f56ae73b35722c56432c9b34820626d72e53/lib/WebpackOptionsApply.js#L278</span>
<span class="token comment">// Step3-1: è°ƒç”¨ new WebpackOptionsApply().process æ–¹æ³•ï¼Œæ³¨å…¥å„ç§å†…ç½®æ’ä»¶</span>
<span class="token comment">// EntryOptionPluginå†…éƒ¨çš„applyæ–¹æ³•ï¼Œä¼šæ³¨å…¥EntryPluginï¼ŒEntryPlugin ç›‘å¬ compiler.make é’©å­ï¼ˆå’ŒStep5æœ‰å…³ï¼‰</span>
<span class="token keyword">new</span> <span class="token class-name">EntryOptionPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>
compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">entryOption</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>context<span class="token punctuation">,</span> options<span class="token punctuation">.</span>entry<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ç›¸å…³æºç å¯è§ï¼š</span>
<span class="token comment">// EntryOptionPluginï¼š</span>
<span class="token comment">// https://github.com/webpack/webpack/blob/2151f56ae73b35722c56432c9b34820626d72e53/lib/EntryOptionPlugin.js#L18</span>
<span class="token comment">// EntryPluginï¼š</span>
<span class="token comment">// https://github.com/webpack/webpack/blob/2151f56ae73b35722c56432c9b34820626d72e53/lib/EntryPlugin.js#L33</span>

<span class="token comment">// Step3-2ï¼šæ³¨å…¥ RuntimePluginï¼Œç”¨äºæ ¹æ®ä»£ç å†…å®¹åŠ¨æ€æ³¨å…¥ webpack è¿è¡Œæ—¶</span>
<span class="token keyword">new</span> <span class="token class-name">RuntimePlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Step3-3: æ ¹æ® devtool å€¼åˆ¤æ–­åç»­ç”¨é‚£ä¸ªæ’ä»¶å¤„ç† sourcemap</span>
<span class="token comment">// EvalSourceMapDevToolPlugin ã€SourceMapDevToolPluginã€EvalDevToolModulePlugin</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>devtool<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>devtool<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&quot;source-map&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> hidden <span class="token operator">=</span> options<span class="token punctuation">.</span>devtool<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&quot;hidden&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> inline <span class="token operator">=</span> options<span class="token punctuation">.</span>devtool<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&quot;inline&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> evalWrapped <span class="token operator">=</span> options<span class="token punctuation">.</span>devtool<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&quot;eval&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> cheap <span class="token operator">=</span> options<span class="token punctuation">.</span>devtool<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&quot;cheap&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> moduleMaps <span class="token operator">=</span> options<span class="token punctuation">.</span>devtool<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&quot;module&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> noSources <span class="token operator">=</span> options<span class="token punctuation">.</span>devtool<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&quot;nosources&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">const</span> Plugin <span class="token operator">=</span> evalWrapped
            <span class="token operator">?</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./EvalSourceMapDevToolPlugin&quot;</span><span class="token punctuation">)</span>
            <span class="token operator">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./SourceMapDevToolPlugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Plugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">filename</span><span class="token operator">:</span> inline <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> options<span class="token punctuation">.</span>output<span class="token punctuation">.</span>sourceMapFilename<span class="token punctuation">,</span>
            <span class="token literal-property property">moduleFilenameTemplate</span><span class="token operator">:</span>
                options<span class="token punctuation">.</span>output<span class="token punctuation">.</span>devtoolModuleFilenameTemplate<span class="token punctuation">,</span>
            <span class="token literal-property property">fallbackModuleFilenameTemplate</span><span class="token operator">:</span>
                options<span class="token punctuation">.</span>output<span class="token punctuation">.</span>devtoolFallbackModuleFilenameTemplate<span class="token punctuation">,</span>
            <span class="token literal-property property">append</span><span class="token operator">:</span> hidden <span class="token operator">?</span> <span class="token boolean">false</span> <span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
            <span class="token literal-property property">module</span><span class="token operator">:</span> moduleMaps <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> cheap <span class="token operator">?</span> <span class="token boolean">false</span> <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token literal-property property">columns</span><span class="token operator">:</span> cheap <span class="token operator">?</span> <span class="token boolean">false</span> <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token literal-property property">noSources</span><span class="token operator">:</span> noSources<span class="token punctuation">,</span>
            <span class="token literal-property property">namespace</span><span class="token operator">:</span> options<span class="token punctuation">.</span>output<span class="token punctuation">.</span>devtoolNamespace<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>devtool<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&quot;eval&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> EvalDevToolModulePlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./EvalDevToolModulePlugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">EvalDevToolModulePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">moduleFilenameTemplate</span><span class="token operator">:</span>
                options<span class="token punctuation">.</span>output<span class="token punctuation">.</span>devtoolModuleFilenameTemplate<span class="token punctuation">,</span>
            <span class="token literal-property property">namespace</span><span class="token operator">:</span> options<span class="token punctuation">.</span>output<span class="token punctuation">.</span>devtoolNamespace<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// å–è‡ª lib/compiler.js</span>
<span class="token comment">// åœ¨compileå‡½æ•°ä¸­å‡ºç°çš„é’©å­æœ‰ï¼šbeforeCompile --&gt; compile --&gt; make --&gt; afterCompile</span>
<span class="token function">compile</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">newCompilationParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>beforeCompile<span class="token punctuation">.</span><span class="token function">callAsync</span><span class="token punctuation">(</span>params<span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// compilationè®°å½•æœ¬æ¬¡ç¼–è¯‘ä½œä¸šçš„ç¯å¢ƒä¿¡æ¯</span>
        <span class="token keyword">const</span> compilation <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">newCompilation</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Step5ï¼šè§¦å‘makeé’©å­ï¼Œè¿™æ—¶å€™ä¼šè§¦å‘EntryPluginè°ƒç”¨addEntryï¼Œæ‰¾åˆ°å…¥å£</span>
        <span class="token comment">// å…¶ä¸­makeå°±æ˜¯æˆ‘ä»¬å…³å¿ƒçš„ç¼–è¯‘è¿‡ç¨‹ã€‚åœ¨è¿™é‡Œå®ƒä»…æ˜¯ä¸€ä¸ªé’©å­è§¦å‘ï¼ŒçœŸæ­£çš„ç¼–è¯‘æ‰§è¡Œæ˜¯æ³¨å†Œåœ¨è¿™ä¸ªé’©å­çš„å›è°ƒä¸Šé¢ï¼ˆå°è£…åœ¨å„ç§æ’ä»¶é‡Œé¢çš„é€»è¾‘ï¼‰</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>make<span class="token punctuation">.</span><span class="token function">callAsync</span><span class="token punctuation">(</span>compilation<span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// ...</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>finishMake<span class="token punctuation">.</span><span class="token function">callAsync</span><span class="token punctuation">(</span>compilation<span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token comment">// ...</span>
                process<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    compilation<span class="token punctuation">.</span><span class="token function">finish</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                        <span class="token comment">// å°è£…æ„å»ºç»“æœï¼ˆsealï¼‰ï¼Œé€æ¬¡å¯¹æ¯ä¸ªmoduleå’Œchunkè¿›è¡Œæ•´ç†ï¼Œæ¯ä¸ªchunkå¯¹åº”ä¸€ä¸ªå…¥å£æ–‡ä»¶</span>
                        compilation<span class="token punctuation">.</span><span class="token function">seal</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                            <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>afterCompile<span class="token punctuation">.</span><span class="token function">callAsync</span><span class="token punctuation">(</span>compilation<span class="token punctuation">,</span> err <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                                <span class="token comment">// å¼‚æ­¥çš„äº‹ä»¶éœ€è¦åœ¨æ’ä»¶å¤„ç†å®Œä»»åŠ¡æ—¶è°ƒç”¨å›è°ƒå‡½æ•°é€šçŸ¥ Webpack è¿›å…¥ä¸‹ä¸€ä¸ªæµç¨‹ï¼Œ</span>
                                <span class="token comment">// ä¸ç„¶è¿è¡Œæµç¨‹å°†ä¼šä¸€ç›´å¡åœ¨è¿™ä¸å¾€ä¸‹æ‰§è¡Œ</span>
                                <span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> compilation<span class="token punctuation">)</span>
                            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>è°ƒç”¨ this.addEntry å‡½æ•°è¡¨ç¤ºæ­£å¼å¼€å§‹è§¦å‘æ„å»ºå†…å®¹ã€‚</p> <p>åœ¨ Step5 è§¦å‘äº†<code>this.hooks.make.callAsync</code>åï¼Œä¼šè§¦å‘ EntryPlugin è°ƒç”¨ addEntryï¼Œå†è¿›ä¸€æ­¥è§¦å‘ä»¥ä¸‹é€»è¾‘ï¼š<br> <code>this.addEntry --&gt; this._addEntryItem -&gt; this.addModuleTree --&gt; this.handleModuleCreation --&gt; this.factorizeModule --&gt; this.addModule --&gt; this.buildModule --&gt; this._buildModule --&gt; module.build...</code></p> <h3 id="æ„å»ºé˜¶æ®µ-make"><a href="#æ„å»ºé˜¶æ®µ-make" class="header-anchor">#</a> æ„å»ºé˜¶æ®µï¼ˆmakeï¼‰</h3> <h4 id="step1-ç¼–è¯‘æ¨¡å—"><a href="#step1-ç¼–è¯‘æ¨¡å—" class="header-anchor">#</a> Step1ï¼šç¼–è¯‘æ¨¡å—</h4> <p>è¿›å…¥ make é˜¶æ®µï¼Œå³è§¦å‘ compilation.hooks.make é’©å­ï¼Œä» entry å‡ºå‘å¼€å§‹ç¼–è¯‘æ¨¡å—ï¼Œå…¶ä¸­ä¼šæ ¹æ®æ¨¡å—èµ„æºç±»å‹è°ƒç”¨å¯¹åº”çš„ loader è¿›è¡Œè½¬è¯‘ï¼Œç„¶åç”Ÿæˆ ASTï¼Œå†éå† AST å»æ”¶é›†ä¾èµ–ã€‚</p> <p>æ ¹æ®æ¨¡å—é—´çš„å¼•ç”¨å…³ç³»ï¼Œé€æ­¥é€’å½’æ„å»ºå‡ºæ¨¡å—ä¾èµ–å…³ç³»å›¾(ModuleDependencyGraph)ï¼Œä¾èµ–å…³ç³»å›¾è¡¨è¾¾äº†æ¨¡å—ä¸æ¨¡å—ä¹‹é—´äº’ç›¸å¼•ç”¨çš„å…ˆåæ¬¡åºã€‚</p> <h4 id="step2-å¤„ç†ä¾èµ–å…³ç³»å›¾-å®Œæˆæ¨¡å—ç¼–è¯‘ã€‚"><a href="#step2-å¤„ç†ä¾èµ–å…³ç³»å›¾-å®Œæˆæ¨¡å—ç¼–è¯‘ã€‚" class="header-anchor">#</a> Step2ï¼šå¤„ç†ä¾èµ–å…³ç³»å›¾ï¼Œå®Œæˆæ¨¡å—ç¼–è¯‘ã€‚</h4> <p>ä¸Šä¸€æ­¥é€’å½’å¤„ç†æ‰€æœ‰èƒ½è§¦è¾¾åˆ°çš„æ¨¡å—åï¼Œå¾—åˆ°äº†æ¯ä¸ªæ¨¡å—è¢«ç¿»è¯‘åçš„å†…å®¹ä»¥åŠå®ƒä»¬ä¹‹é—´çš„ä¾èµ–å…³ç³»å›¾ã€‚</p> <p>åŸºäºä¾èµ–å…³ç³»å›¾ï¼Œ webpack å°±å¯ä»¥æ¨æ–­å‡ºæ¨¡å—è¿è¡Œä¹‹å‰éœ€è¦å…ˆæ‰§è¡Œé‚£äº›ä¾èµ–æ¨¡å—ï¼Œä¹Ÿå°±å¯ä»¥è¿›ä¸€æ­¥æ¨æ–­å‡ºå“ªäº›æ¨¡å—åº”è¯¥æ‰“åŒ…åœ¨ä¸€èµ·ï¼Œå“ªäº›æ¨¡å—å¯ä»¥å»¶ååŠ è½½(å¼‚æ­¥æ‰§è¡Œ)ã€‚</p> <h4 id="ç»†èŠ‚å±•å¼€"><a href="#ç»†èŠ‚å±•å¼€" class="header-anchor">#</a> ç»†èŠ‚å±•å¼€</h4> <p>æ„å»ºè¿‡ç¨‹å¼•å…¥æ¥è‡ª<a href="https://juejin.cn/post/6949040393165996040#heading-4" target="_blank" rel="noopener noreferrer">æ–‡æ°å¤§ä½¬æ–‡ç« <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>çš„å›¾å’Œæ–‡å­—æè¿°ï¼š<br> <img src="https://ftp.bmp.ovh/imgs/2021/05/be14dbb967ae8fdd.png" alt=""></p> <blockquote><p><code>Dependency</code>ï¼šåœ¨æ¨¡å—ä¸­å¼•ç”¨å…¶å®ƒæ¨¡å—ï¼Œä¾‹å¦‚ import &quot;a.js&quot; è¯­å¥ï¼Œwebpack ä¼šå…ˆå°†å¼•ç”¨å…³ç³»è¡¨è¿°ä¸º Dependency å­ç±»å¹¶å…³è” module å¯¹è±¡ï¼Œç­‰åˆ°å½“å‰ module å†…å®¹éƒ½è§£æå®Œæ¯•ä¹‹åï¼Œå¯åŠ¨ä¸‹æ¬¡å¾ªç¯å¼€å§‹ï¼Œå°† Dependency å¯¹è±¡è½¬æ¢ä¸ºé€‚å½“çš„ Module å­ç±»ã€‚</p></blockquote> <blockquote><p><code>ModuleGraph</code> å¯¹è±¡é€šè¿‡ <code>_dependencyMap</code> å±æ€§è®°å½• <code>Dependency</code> å¯¹è±¡ä¸ <code>ModuleGraphConnectionï¼ˆoriginModule/moduleï¼‰</code> è¿æ¥å¯¹è±¡ä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼Œåç»­çš„å¤„ç†ä¸­å¯ä»¥åŸºäºè¿™å±‚æ˜ å°„è¿…é€Ÿæ‰¾åˆ° <strong>Dependency å®ä¾‹å¯¹åº”çš„å¼•ç”¨ä¸è¢«å¼•ç”¨è€…</strong></p></blockquote> <blockquote><p><code>ModuleGraph</code> å¯¹è±¡é€šè¿‡ <code>_moduleMap</code> åœ¨ <code>module</code> åŸºç¡€ä¸Šé™„åŠ  <code>ModuleGraphModule</code> ä¿¡æ¯ï¼Œè€Œ <code>ModuleGraphModuleï¼ˆincomingConnectionsè¡¨ç¤ºè°å¼•ç”¨äº†è‡ªå·±/outgoingConnectionsè¡¨ç¤ºè‡ªå·±å¼•ç”¨äº†è°ï¼‰</code> æœ€å¤§çš„ä½œç”¨å°±æ˜¯è®°å½•äº†<strong>æ¨¡å—çš„å¼•ç”¨ä¸è¢«å¼•ç”¨å…³ç³»</strong>ï¼Œåç»­çš„å¤„ç†å¯ä»¥åŸºäºè¯¥å±æ€§æ‰¾åˆ° module å®ä¾‹çš„æ‰€æœ‰ä¾èµ–ä¸è¢«ä¾èµ–å…³ç³»</p></blockquote> <blockquote><p>ä¾èµ–å…³ç³»æ”¶é›†è¿‡ç¨‹ä¸»è¦å‘ç”Ÿåœ¨ä¸¤ä¸ªèŠ‚ç‚¹ï¼š<code>addDependency</code>å’Œ<code>handleModuleCreation</code>ï¼š<br> <code>addDependency</code>ï¼š webpack ä»æ¨¡å—å†…å®¹ä¸­è§£æå‡ºå¼•ç”¨å…³ç³»åï¼Œåˆ›å»ºé€‚å½“çš„ Dependency å­ç±»å¹¶è°ƒç”¨è¯¥æ–¹æ³•è®°å½•åˆ° module å®ä¾‹<br> <code>handleModuleCreation</code>ï¼šæ ¹æ®æ–‡ä»¶ç±»å‹æ„å»º module å­ç±»</p></blockquote> <h4 id="ä¾‹å­"><a href="#ä¾‹å­" class="header-anchor">#</a> ä¾‹å­</h4> <p>å‡è®¾ï¼Œæœ‰å…¥å£æ–‡ä»¶<code>index.js</code>ï¼Œä¾èµ–<code>a.js</code>å’Œ<code>b.js</code>ï¼Œå…¶ä¸­<code>a.js</code>ä¾èµ–<code>c.js</code>å’Œ<code>d.js</code>ï¼Œé‚£è§£æçš„è¿‡ç¨‹å¯ä»¥åˆ†ä¸ºä»¥ä¸‹æ­¥éª¤ï¼š</p> <ul><li><p>Step1: EntryPlugin æ ¹æ® entry é…ç½®æ‰¾åˆ° index.js æ–‡ä»¶ï¼Œè°ƒç”¨ <code>compilation.addEntry</code> å‡½æ•°è§¦å‘æ„å»ºæµç¨‹ï¼›</p></li> <li><p>Step2: è§¦å‘<code>handleModuleCreation</code>ï¼Œé€šè¿‡<code>module.build</code> å¯¹ module è¿›è¡Œç¼–è¯‘ï¼›</p> <p><code>module.build</code>ä¼šç”Ÿæˆäº†ä¸€ä¸ª<code>module[index.js]</code>ï¼ŒåŠå…¶ä¾èµ–å¯¹è±¡åˆ—è¡¨<code>dependence[a.js]</code>å’Œ<code>dependence[b.js]</code>;</p> <p>å…¶ä¸­æ­¥éª¤åŒ…æ‹¬ï¼š<br>
1ï¼‰ä¼šè°ƒç”¨<code>runLoaders</code> è½¬è¯‘ module æºæ–‡ä»¶å†…å®¹ï¼Œé€šå¸¸æ˜¯ä»å„ç±»èµ„æºç±»å‹è½¬è¯‘ä¸º JavaScript ä»£ç ï¼›(åŸå› æ˜¯ webpack åªè¯†åˆ« JS æ¨¡å—ï¼Œå…¶ä»–æ ¼å¼éœ€è¦ loader ååŠ©)</p> <p>2ï¼‰è°ƒç”¨ <code>acorn</code> å°† JS æ–‡æœ¬è§£æä¸º<code>AST</code>ï¼›</p> <p>ç›¸å…³ä»£ç  lib/NormalModule.js#L1004ï¼š<code>result = this.parser.parse(this._ast || this._source.source()</code>ï¼›</p> <p><code>this.parser</code>å…¶å®å°±æ˜¯<code>JavascriptParserçš„å®ä¾‹å¯¹è±¡</code>ï¼ŒJavascriptParser ä¼šè°ƒç”¨ç¬¬ä¸‰æ–¹åŒ… acorn çš„ parse æ–¹æ³•å¯¹ JS ä»£ç è¿›è¡Œè¯­æ³•è§£ææˆ<code>AST</code>ã€‚ï¼ˆè¿™é‡Œæœ‰å¯èƒ½åœ¨ loader å¤„ç†è¿‡ç¨‹ä¸­å°±ç›´æ¥å°†æ–‡ä»¶è½¬æˆ AST äº†ï¼Œè¿™ç§æƒ…å†µä¼šè¢«ä¿å­˜åˆ° <code>extraInfo.webpackAST</code> ä¸­ï¼Œç„¶ååœ¨è¿™ä¸€æ­¥å°±å¯ç›´æ¥å¤ç”¨ï¼Œä»¥é¿å…é‡å¤ç”Ÿæˆ ASTï¼Œæå‡æ€§èƒ½ã€‚ï¼‰</p> <p>3ï¼‰éå† ASTï¼Œè§¦å‘å„ç§é’©å­ï¼Œå…¶ä¸­åŒ…æ‹¬ï¼š</p> <ul><li><p>HarmonyImportDependencyParserPlugin æ’ä»¶ç›‘å¬ <code>import</code> å’Œ <code>importSpecifier</code> é’©å­ï¼Œå¯¹ä¾èµ–èµ„æºè¿›è¡Œé€»è¾‘å¤„ç†ï¼›</p></li> <li><p><strong>é‡åˆ° import/require è¯­å¥å°±å¢åŠ ç›¸å…³ä¾èµ–ï¼Œè°ƒç”¨ module å¯¹è±¡çš„<code>addDependency</code>å°†ä¾èµ–å¯¹è±¡åŠ å…¥åˆ° module ä¾èµ–åˆ—è¡¨ä¸­ã€‚</strong></p></li></ul> <p>æ¥ä¸‹æ¥å°±æ˜¯å¯¹ä¾èµ–åˆ—è¡¨è¿›è¡Œå¤„ç†ã€‚</p></li> <li><p>Step3ï¼š AST éå†å®Œï¼Œä¼šå›åˆ° dobuild å›è°ƒï¼Œè°ƒç”¨ handleParseResultã€‚å¯¹äº module æ–°å¢çš„ä¾èµ–å†æ¬¡è°ƒç”¨ <code>handleModuleCreation</code>ï¼Œæ§åˆ¶æµå›åˆ° Step2ã€‚</p> <p>è°ƒç”¨<code>handleModuleCreation</code>æ–¹æ³•åˆ›å»º Dependency å¯¹åº”çš„å­æ¨¡å—å¯¹è±¡ï¼Œä¹‹åè°ƒç”¨ <code>moduleGraph.setResolvedModule</code>å°†çˆ¶å­å¼•ç”¨ä¿¡æ¯è®°å½•åˆ° <code>moduleGraph</code> å¯¹è±¡ä¸Šã€‚</p> <p><code>module[index.js]</code> çš„ handleParseResult å‡½æ•°ï¼Œç»§ç»­å¤„ç† a.jsã€b.js æ–‡ä»¶ï¼Œé€’å½’ä¸Šè¿°æµç¨‹ï¼Œè¿›ä¸€æ­¥å¾—åˆ° aã€b æ¨¡å—<code>module[a.js]</code>å’Œ<code>module[b.js]</code>ï¼› æ¥ç€ï¼Œå¯¹<code>module[a.js]</code>ä¹Ÿä¼šè¿›è¡Œæ”¶é›†ä¾èµ–ï¼Œå¾—åˆ°å…¶ä¾èµ–å¯¹è±¡åˆ—è¡¨<code>dependence[c.js]</code>å’Œ<code>dependence[d.js]</code>ã€‚</p></li></ul> <p>è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ•°æ®æµ<code>module =&gt; ast =&gt; dependencies =&gt; module</code> ï¼Œå³å…ˆè½¬ AST å†ä»ä¸­éå†æ‰¾ä¾èµ–ã€‚ç»è¿‡æ”¶é›†åçš„ ModuleGraph ç»“æ„ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">ModuleGraph</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">_dependencyMap</span><span class="token operator">:</span> <span class="token function">Map</span><span class="token punctuation">(</span><span class="token parameter"><span class="token number">3</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token punctuation">{</span>
            EntryDependency<span class="token punctuation">{</span><span class="token literal-property property">request</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">}</span> <span class="token operator">=&gt;</span> ModuleGraphConnection<span class="token punctuation">{</span>
                <span class="token literal-property property">module</span><span class="token operator">:</span> NormalModule<span class="token punctuation">{</span><span class="token literal-property property">request</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token literal-property property">originModule</span><span class="token operator">:</span> <span class="token keyword">null</span> <span class="token comment">// å…¥å£æ¨¡å—æ²¡æœ‰å¼•ç”¨è€…ï¼Œæ•…è®¾ç½®ä¸º null</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            HarmonyImportSideEffectDependency<span class="token punctuation">{</span><span class="token literal-property property">request</span><span class="token operator">:</span> <span class="token string">&quot;./src/a.js&quot;</span><span class="token punctuation">}</span> <span class="token operator">=&gt;</span> ModuleGraphConnection<span class="token punctuation">{</span>
                <span class="token literal-property property">module</span><span class="token operator">:</span> NormalModule<span class="token punctuation">{</span><span class="token literal-property property">request</span><span class="token operator">:</span> <span class="token string">&quot;./src/a.js&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token literal-property property">originModule</span><span class="token operator">:</span> NormalModule<span class="token punctuation">{</span><span class="token literal-property property">request</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">// b.jsåŒç†...</span>
        <span class="token punctuation">{</span>
            HarmonyImportSideEffectDependency<span class="token punctuation">{</span><span class="token literal-property property">request</span><span class="token operator">:</span> <span class="token string">&quot;./src/c.js&quot;</span><span class="token punctuation">}</span> <span class="token operator">=&gt;</span> ModuleGraphConnection<span class="token punctuation">{</span>
                <span class="token literal-property property">module</span><span class="token operator">:</span> NormalModule<span class="token punctuation">{</span><span class="token literal-property property">request</span><span class="token operator">:</span> <span class="token string">&quot;./src/c.js&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token literal-property property">originModule</span><span class="token operator">:</span> NormalModule<span class="token punctuation">{</span><span class="token literal-property property">request</span><span class="token operator">:</span> <span class="token string">&quot;./src/a.js&quot;</span><span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">// d.jsåŒç†...</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token literal-property property">_moduleMap</span><span class="token operator">:</span> <span class="token function">Map</span><span class="token punctuation">(</span><span class="token parameter"><span class="token number">3</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        NormalModule<span class="token punctuation">{</span><span class="token literal-property property">request</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">}</span> <span class="token operator">=&gt;</span> ModuleGraphModule<span class="token punctuation">{</span>
            <span class="token literal-property property">incomingConnections</span><span class="token operator">:</span> <span class="token function">Set</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">[</span> <span class="token comment">// è°å¼•ç”¨äº†è‡ªå·±</span>
                <span class="token comment">// entry æ¨¡å—ï¼Œå¯¹åº” originModule ä¸ºnull</span>
                ModuleGraphConnection<span class="token punctuation">{</span> <span class="token literal-property property">module</span><span class="token operator">:</span> NormalModule<span class="token punctuation">{</span><span class="token literal-property property">request</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token literal-property property">originModule</span><span class="token operator">:</span><span class="token keyword">null</span> <span class="token punctuation">}</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token literal-property property">outgoingConnections</span><span class="token operator">:</span> <span class="token function">Set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">[</span> <span class="token comment">// è‡ªå·±å¼•ç”¨äº†è°</span>
                <span class="token comment">// ä» index æŒ‡å‘ a æ¨¡å—</span>
                ModuleGraphConnection<span class="token punctuation">{</span> <span class="token literal-property property">module</span><span class="token operator">:</span> NormalModule<span class="token punctuation">{</span><span class="token literal-property property">request</span><span class="token operator">:</span> <span class="token string">&quot;./src/a.js&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token literal-property property">originModule</span><span class="token operator">:</span> NormalModule<span class="token punctuation">{</span><span class="token literal-property property">request</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token comment">// ä» index æŒ‡å‘ b æ¨¡å—</span>
                ModuleGraphConnection<span class="token punctuation">{</span> <span class="token literal-property property">module</span><span class="token operator">:</span> NormalModule<span class="token punctuation">{</span><span class="token literal-property property">request</span><span class="token operator">:</span> <span class="token string">&quot;./src/b.js&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token literal-property property">originModule</span><span class="token operator">:</span> NormalModule<span class="token punctuation">{</span><span class="token literal-property property">request</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">}</span> <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        NormalModule<span class="token punctuation">{</span><span class="token literal-property property">request</span><span class="token operator">:</span> <span class="token string">&quot;./src/a.js&quot;</span><span class="token punctuation">}</span> <span class="token operator">=&gt;</span> ModuleGraphModule<span class="token punctuation">{</span>
            <span class="token literal-property property">incomingConnections</span><span class="token operator">:</span> <span class="token function">Set</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>
                ModuleGraphConnection<span class="token punctuation">{</span> <span class="token literal-property property">module</span><span class="token operator">:</span> NormalModule<span class="token punctuation">{</span><span class="token literal-property property">request</span><span class="token operator">:</span> <span class="token string">&quot;./src/a.js&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token literal-property property">originModule</span><span class="token operator">:</span> NormalModule<span class="token punctuation">{</span><span class="token literal-property property">request</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">}</span> <span class="token punctuation">}</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token literal-property property">outgoingConnections</span><span class="token operator">:</span> <span class="token function">Set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>
                <span class="token comment">// ä» a æŒ‡å‘ c æ¨¡å—</span>
                ModuleGraphConnection<span class="token punctuation">{</span> <span class="token literal-property property">module</span><span class="token operator">:</span> NormalModule<span class="token punctuation">{</span><span class="token literal-property property">request</span><span class="token operator">:</span> <span class="token string">&quot;./src/c.js&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token literal-property property">originModule</span><span class="token operator">:</span> NormalModule<span class="token punctuation">{</span><span class="token literal-property property">request</span><span class="token operator">:</span> <span class="token string">&quot;./src/a.js&quot;</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token comment">// ä» a æŒ‡å‘ d æ¨¡å—</span>
                ModuleGraphConnection<span class="token punctuation">{</span> <span class="token literal-property property">module</span><span class="token operator">:</span> NormalModule<span class="token punctuation">{</span><span class="token literal-property property">request</span><span class="token operator">:</span> <span class="token string">&quot;./src/d.js&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token literal-property property">originModule</span><span class="token operator">:</span> NormalModule<span class="token punctuation">{</span><span class="token literal-property property">request</span><span class="token operator">:</span> <span class="token string">&quot;./src/a.js&quot;</span><span class="token punctuation">}</span> <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        NormalModule<span class="token punctuation">{</span><span class="token literal-property property">request</span><span class="token operator">:</span> <span class="token string">&quot;./src/b.js&quot;</span><span class="token punctuation">}</span> <span class="token operator">=&gt;</span> ModuleGraphModule<span class="token punctuation">{</span>
            <span class="token literal-property property">incomingConnections</span><span class="token operator">:</span> <span class="token function">Set</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>
                ModuleGraphConnection<span class="token punctuation">{</span> <span class="token literal-property property">module</span><span class="token operator">:</span> NormalModule<span class="token punctuation">{</span><span class="token literal-property property">request</span><span class="token operator">:</span> <span class="token string">&quot;./src/b.js&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token literal-property property">originModule</span><span class="token operator">:</span> NormalModule<span class="token punctuation">{</span><span class="token literal-property property">request</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">}</span> <span class="token punctuation">}</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token comment">// b æ¨¡å—æ²¡æœ‰å…¶ä»–ä¾èµ–ï¼Œæ•… outgoingConnections å±æ€§å€¼ä¸º undefined</span>
            <span class="token literal-property property">outgoingConnections</span><span class="token operator">:</span> <span class="token keyword">undefined</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        NormalModule<span class="token punctuation">{</span><span class="token literal-property property">request</span><span class="token operator">:</span> <span class="token string">&quot;./src/c.js&quot;</span><span class="token punctuation">}</span> <span class="token operator">=&gt;</span> ModuleGraphModule<span class="token punctuation">{</span>
            <span class="token literal-property property">incomingConnections</span><span class="token operator">:</span> <span class="token function">Set</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>
                ModuleGraphConnection<span class="token punctuation">{</span> <span class="token literal-property property">module</span><span class="token operator">:</span> NormalModule<span class="token punctuation">{</span><span class="token literal-property property">request</span><span class="token operator">:</span> <span class="token string">&quot;./src/c.js&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token literal-property property">originModule</span><span class="token operator">:</span> NormalModule<span class="token punctuation">{</span><span class="token literal-property property">request</span><span class="token operator">:</span> <span class="token string">&quot;./src/a.js&quot;</span><span class="token punctuation">}</span> <span class="token punctuation">}</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token literal-property property">outgoingConnections</span><span class="token operator">:</span> <span class="token keyword">undefined</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">// d.jsåŒç†...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="ç”Ÿæˆé˜¶æ®µ-seal"><a href="#ç”Ÿæˆé˜¶æ®µ-seal" class="header-anchor">#</a> ç”Ÿæˆé˜¶æ®µï¼ˆsealï¼‰</h3> <p>è‡³æ­¤ï¼Œä»å…¥å£æ–‡ä»¶å¼€å§‹ï¼Œwebpack å·²ç»æ”¶é›†å®Œæ•´äº†æ¨¡å—çš„ä¿¡æ¯å’Œä¾èµ–é¡¹ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å¦‚ä½•è¿›ä¸€æ­¥æ‰“åŒ…å°è£…æ¨¡å—äº†ã€‚æ„å»ºé˜¶æ®µå›´ç»• module å±•å¼€ï¼Œç”Ÿæˆé˜¶æ®µåˆ™å›´ç»• chunks å±•å¼€ã€‚</p> <p>chunks ç”Ÿæˆçš„å¤§æ¦‚è¿‡ç¨‹ï¼š<br>
1.webpack é¦–å…ˆä¼šå°† entry ä¸­å¯¹åº”çš„ module éƒ½ç”Ÿæˆä¸€ä¸ªæ–°çš„ chunkã€‚<br>
2.éå† module å¯¹åº”çš„ä¾èµ–åˆ—è¡¨ï¼Œå°†å…¶ä¾èµ–çš„æ¨¡å—ä¹ŸåŠ å…¥åˆ° chunk ä¸­ã€‚<br>
3.å¦‚æœä¾èµ–çš„æ¨¡å—æ˜¯åŠ¨æ€å¼•å…¥çš„æ¨¡å—ï¼Œä¼šæ ¹æ®è¿™ä¸ª module åˆ›å»ºä¸€ä¸ªæ–°çš„ chunkï¼Œç»§ç»­éå†ä¾èµ–ã€‚<br>
4.é‡å¤ä¸Šé¢çš„è¿‡ç¨‹ï¼Œç›´è‡³å¾—åˆ°æ‰€æœ‰çš„ chunkã€‚</p> <h4 id="seal-è¿‡ç¨‹"><a href="#seal-è¿‡ç¨‹" class="header-anchor">#</a> seal è¿‡ç¨‹</h4> <p>seal ä¸»è¦å®Œæˆä» module åˆ° chunks çš„è½¬åŒ–ï¼Œä¸»è¦å›´ç»• Chunk åŠ ChunkGroup ä¸¤ä¸ªç±»å‹å±•å¼€ã€‚</p> <p>1ï¼‰chunkï¼Œç”± module ç»„æˆï¼Œä¸€ä¸ª chunk å¯ä»¥åŒ…å«å¤šä¸ª moduleï¼Œå®ƒæ˜¯ webpack ç¼–è¯‘æ‰“åŒ…åè¾“å‡ºçš„æœ€ç»ˆæ–‡ä»¶ï¼›<br>
2ï¼‰chunkGroupï¼Œç”± chunk ç»„æˆï¼Œä¸€ä¸ª chunkGroup å¯ä»¥åŒ…å«å¤šä¸ª chunkï¼Œåœ¨ç”Ÿæˆ/ä¼˜åŒ– ChunkGraph æ—¶ä¼šç”¨åˆ°ã€‚</p> <ul><li><p>Step1ï¼šæ ¹æ® moduleGraph æ„å»ºæœ¬æ¬¡ç¼–è¯‘çš„ chunkGraph å¯¹è±¡ï¼›</p></li> <li><p>Step2ï¼šéå† compilation.modules é›†åˆï¼Œå¯¹ entry å…¥å£æ–‡ä»¶ å’ŒåŠ¨æ€å¼•å…¥åˆ†é…ç»™ä¸åŒçš„ Chunk å¯¹è±¡ï¼ˆç”Ÿæˆ chunkï¼‰ï¼›</p></li> <li><p>Step3ï¼šcreateChunkAssets éå† module/chunkï¼ŒæŠŠæ‰€æœ‰ä¾èµ–é¡¹é€šè¿‡å¯¹åº”çš„æ¨¡æ¿ render å‡ºä¸€ä¸ªæ‹¼æ¥å¥½çš„å­—ç¬¦ä¸²ï¼›</p></li></ul> <blockquote><p>createChunkAssets æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¼šä¼˜å…ˆè¯»å– cache ä¸­æ˜¯å¦å·²ç»æœ‰äº†ç›¸åŒ hash çš„èµ„æºï¼Œå¦‚æœæœ‰ï¼Œåˆ™ç›´æ¥è¿”å›å†…å®¹ï¼Œå¦åˆ™æ‰ä¼šç»§ç»­æ‰§è¡Œæ¨¡å—ç”Ÿæˆçš„é€»è¾‘ï¼Œå¹¶å­˜å…¥ cache ä¸­ã€‚<br>
seal é˜¶æ®µç»å†äº†å¾ˆå¤šçš„ä¼˜åŒ–ï¼Œæœ€ç»ˆç”Ÿæˆçš„ä»£ç ä¼šå­˜æ”¾åœ¨ Compilation çš„ assets å±æ€§ä¸Šã€‚ç¬¬ä¸‰æ–¹ webpack æ’ä»¶ä¹Ÿå¾ˆå¤šä¼šé€šè¿‡ compilation.assets å’Œ compilation.chunks è¿›è¡Œé€»è¾‘æ‹“å±•ã€‚</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// å–è‡ª lib/Compilation.js#L2235</span>
<span class="token comment">// æ ¹æ®moduleGraphæ„å»ºChunkGraph</span>
<span class="token keyword">const</span> chunkGraph <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ChunkGraph</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>moduleGraph<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ChunkGraphè¿‡ç¨‹ä¸­ä¼šè°ƒç”¨_getGraphRootsæ–¹æ³•ï¼Œé€šè¿‡ moduleGraph.getOutgoingConnections(module)æŸ¥æ‰¾ module å®ä¾‹çš„æ‰€æœ‰ä¾èµ–</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>chunkGraph <span class="token operator">=</span> chunkGraph<span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> module <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">.</span>modules<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ChunkGraph<span class="token punctuation">.</span><span class="token function">setChunkGraphForModule</span><span class="token punctuation">(</span>module<span class="token punctuation">,</span> chunkGraph<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// éå†æ ¹æ® addEntry æ–¹æ³•ä¸­æ”¶é›†åˆ°å…¥å£æ–‡ä»¶ç»„æˆçš„this.entriesæ•°ç»„</span>
<span class="token keyword">const</span> chunkGraphInit <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">[</span>name<span class="token punctuation">,</span> <span class="token punctuation">{</span> dependencies<span class="token punctuation">,</span> includeDependencies<span class="token punctuation">,</span> options <span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">.</span>entries<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ¯ä¸ªå…¥å£ åˆ›å»ºä¸€ä¸ªchunk</span>
    <span class="token keyword">const</span> chunk <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addChunk</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>filename<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        chunk<span class="token punctuation">.</span>filenameTemplate <span class="token operator">=</span> options<span class="token punctuation">.</span>filename<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// æ¯ä¸€ä¸ª entryPoint å°±æ˜¯ä¸€ä¸ª chunkGroup</span>
    <span class="token keyword">const</span> entrypoint <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Entrypoint</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>options<span class="token punctuation">.</span>dependOn <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>options<span class="token punctuation">.</span>runtime<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// è®¾ç½® runtime chunk</span>
        <span class="token comment">// åŒæ—¶å†…éƒ¨ä¼šæœ‰ä¸ªæ¯”è¾ƒç‰¹æ®Šçš„ runtimeChunk(å½“ webpack æœ€ç»ˆç¼–è¯‘å®ŒæˆååŒ…å«çš„webpack runtimeä»£ç æœ€ç»ˆä¼šæ³¨å…¥åˆ° runtimeChunkå½“ä¸­)</span>
        entrypoint<span class="token punctuation">.</span><span class="token function">setRuntimeChunk</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    entrypoint<span class="token punctuation">.</span><span class="token function">setEntrypointChunk</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// è®¾ç½® chunkGroups çš„å†…å®¹</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>namedChunkGroups<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> entrypoint<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>entrypoints<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> entrypoint<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>chunkGroups<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>entrypoint<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// å»ºç«‹èµ· chunkGroup å’Œ chunk ä¹‹é—´çš„å…³ç³»</span>
    <span class="token function">connectChunkGroupAndChunk</span><span class="token punctuation">(</span>entrypoint<span class="token punctuation">,</span> chunk<span class="token punctuation">)</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> dep <span class="token keyword">of</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>globalEntry<span class="token punctuation">.</span>dependencies<span class="token punctuation">,</span> <span class="token operator">...</span>dependencies<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        entrypoint<span class="token punctuation">.</span><span class="token function">addOrigin</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">/** @type {any} */</span> <span class="token punctuation">(</span>dep<span class="token punctuation">)</span><span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">const</span> module <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>moduleGraph<span class="token punctuation">.</span><span class="token function">getModule</span><span class="token punctuation">(</span>dep<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>module<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            chunkGraph<span class="token punctuation">.</span><span class="token function">connectChunkAndEntryModule</span><span class="token punctuation">(</span>chunk<span class="token punctuation">,</span> module<span class="token punctuation">,</span> entrypoint<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> modulesList <span class="token operator">=</span> chunkGraphInit<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>entrypoint<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>modulesList <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// æ„å»ºäº†chunk å’Œå…¥å£ module ä¹‹é—´çš„è”ç³»</span>
                chunkGrphInit<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>entrypoint<span class="token punctuation">,</span> <span class="token punctuation">[</span>module<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                modulesList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>module<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment">//  ...</span>

    <span class="token comment">// å–è‡ª lib/Compilation.js#L3763</span>
    <span class="token function">createChunkAssets</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">const</span> outputOptions <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>outputOptions<span class="token punctuation">;</span>
		<span class="token keyword">const</span> cachedSourceMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">/** @type {Map&lt;string, {hash: string, source: Source, chunk: Chunk}&gt;} */</span>
		<span class="token keyword">const</span> alreadyWrittenFiles <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        asyncLib<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>chunks<span class="token punctuation">,</span>
            <span class="token punctuation">(</span><span class="token parameter">chunk<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token comment">// manifestæ˜¯æ•°ç»„ç»“æ„ï¼Œæ¯ä¸ªmanifestå…ƒç´ éƒ½æä¾›äº† `render` æ–¹æ³•æä¾›åç»­çš„æºç å­—ç¬¦ä¸²ç”ŸæˆæœåŠ¡ã€‚</span>
                <span class="token comment">// è‡³äºrenderæ–¹æ³•ä½•æ—¶åˆå§‹åŒ–çš„ï¼Œåœ¨`./lib/MainTemplate.js`ä¸­</span>
                <span class="token keyword">let</span> manifest <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getRenderManifest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

                asyncLib<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>manifest<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">fileManifest<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                        <span class="token operator">...</span>
                        source <span class="token operator">=</span> fileManifest<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emitAsset</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> source<span class="token punctuation">,</span> assetInfo<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    callback
                <span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            callback
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>




    <span class="token comment">// todo æœªå®Œå¾…ç»­ï¼Œå›å¤´ç»§ç»­åˆ†æ</span>



</code></pre></div><h3 id="å†™å…¥é˜¶æ®µ-emit"><a href="#å†™å…¥é˜¶æ®µ-emit" class="header-anchor">#</a> å†™å…¥é˜¶æ®µï¼ˆemitï¼‰</h3> <p>åœ¨ seal æ‰§è¡Œåï¼Œå…³äºæ¨¡å—æ‰€æœ‰ä¿¡æ¯ä»¥åŠæ‰“åŒ…åæºç ä¿¡æ¯éƒ½å­˜åœ¨å†…å­˜ä¸­ï¼Œä¹Ÿå¯ä»¥åœ¨ä¼ å…¥äº‹ä»¶å›è°ƒçš„ compilation.assets ä¸Šæ‹¿åˆ°æ‰€éœ€æ•°æ®ã€‚</p> <p>æ­¤æ—¶æ§åˆ¶æµä¼šå›åˆ° compiler ä¸­ï¼Œè§¦å‘ emitAssetsã€‚å‡½æ•°å†…éƒ¨è°ƒç”¨ <code>compiler.outputFileSystem.writeFile</code> æ–¹æ³•ï¼Œå°† assets é›†åˆæ ¹æ® output é…ç½®çš„ path å±æ€§ï¼Œå°†æ–‡ä»¶è¾“å‡ºåˆ°æŒ‡å®šçš„æ–‡ä»¶å¤¹ã€‚</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/articles/Project Management/Webpack åŸºç¡€æ‰«ç›².html" class="prev">
        ğŸ‘‰ Webpack åŸºç¡€æ‰«ç›²
      </a></span> <span class="next"><a href="/articles/Project Management/Webæ€§èƒ½ä¼˜åŒ–.html">
        ğŸ‘‰ Web æ€§èƒ½ä¼˜åŒ–
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.448d156c.js" defer></script><script src="/assets/js/2.fefa3fa1.js" defer></script><script src="/assets/js/1.67a15f5a.js" defer></script><script src="/assets/js/63.3358d1e0.js" defer></script>
  </body>
</html>
